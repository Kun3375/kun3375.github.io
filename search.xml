<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[RokcetMQ ÈÖçÁΩÆÈ°π]]></title>
    <url>%2F2018%2F08%2F11%2FRocketMQ-%E9%85%8D%E7%BD%AE%E9%A1%B9%2F</url>
    <content type="text"><![CDATA[RocketMQ ÁöÑÈÖçÁΩÆÂàÜ‰∏∫‰∏§ÈÉ®ÂàÜÔºå‰∏ÄËÄÖÊòØ JVM ÁöÑÈÖçÂêàÔºåÂè¶‰∏ÄËÄÖÂàôÊòØÂØπ Broker Â∫îÁî®Êú¨Ë∫´ÁöÑÂèÇÊï∞ÈÖçÁΩÆ„ÄÇÂú®ÂàùÊ¨°Êé•Ëß¶Êó∂ÂÄôÔºåÈô§‰∫Ü RocketMQ Êú¨Ë∫´ÁöÑ‰∏Ä‰∫õÁâπÊÄßÔºåÂêåÊó∂‰πüÈöæÂÖç‰ºöË¢´‰∏Ä‰∫õÈÖçÁΩÆÁªôËø∑ÊÉëÊàñËÄÖË∏©ÂùëÔºåËøôÈáåÊù•Áúã‰∏Ä‰∏ãÈÄöÂ∏∏ÁöÑÈÖçÁΩÆÁÇπ„ÄÇ Broker JVM ÈÖçÁΩÆJVM ÁöÑÈÖçÁΩÆÈªòËÆ§‰∏çÈúÄË¶Å‰øÆÊîπÔºåÂè™ÈúÄË¶ÅÊ†πÊçÆÁ°¨‰ª∂ÊÉÖÂÜµË∞ÉÊï¥Áõ∏Â∫îÁöÑÂ†ÜÊ†àÂÜÖÂ≠òÂíåÂØπÂ§ñÂÜÖÂ≠òÁöÑÂç†Áî®ÈáèÂç≥ÂèØ„ÄÇÈôÑ‰∏äÂêØÂä®Êó∂ÁöÑ JVM ÈÖçÁΩÆËÑöÊú¨ÁâáÊÆµÔºö123456789101112JAVA_OPT="$&#123;JAVA_OPT&#125; -server -Xms8g -Xmx8g -Xmn4g"JAVA_OPT="$&#123;JAVA_OPT&#125; -XX:+UseG1GC -XX:G1HeapRegionSize=16m -XX:G1ReservePercent=25 -XX:InitiatingHeapOccupancyPercent=30 -XX:SoftRefLRUPolicyMSPerMB=0 -XX:SurvivorRatio=8 -XX:+DisableExplicitGC"JAVA_OPT="$&#123;JAVA_OPT&#125; -verbose:gc -Xloggc:/dev/shm/mq_gc_%p.log -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:+PrintGCApplicationStoppedTime -XX:+PrintAdaptiveSizePolicy"JAVA_OPT="$&#123;JAVA_OPT&#125; -XX:+UseGCLogFileRotation -XX:NumberOfGCLogFiles=5 -XX:GCLogFileSize=30m"JAVA_OPT="$&#123;JAVA_OPT&#125; -XX:-OmitStackTraceInFastThrow"JAVA_OPT="$&#123;JAVA_OPT&#125; -XX:+AlwaysPreTouch"JAVA_OPT="$&#123;JAVA_OPT&#125; -XX:MaxDirectMemorySize=15g"JAVA_OPT="$&#123;JAVA_OPT&#125; -XX:-UseLargePages -XX:-UseBiasedLocking"JAVA_OPT="$&#123;JAVA_OPT&#125; -Djava.ext.dirs=$&#123;BASE_DIR&#125;/lib"#JAVA_OPT="$&#123;JAVA_OPT&#125; -Xdebug -Xrunjdwp:transport=dt_socket,address=9555,server=y,suspend=n"JAVA_OPT="$&#123;JAVA_OPT&#125; $&#123;JAVA_OPT_EXT&#125;"JAVA_OPT="$&#123;JAVA_OPT&#125; -cp $&#123;CLASSPATH&#125;" ÈúÄË¶ÅÈ¢ùÂ§ñÂÖ≥Ê≥®ÁöÑÁÇπÂú®‰∫éÔºö -Xms8g -Xmx8g -Xmn4g ÈªòËÆ§ Broker ÈúÄË¶Å 8g ÁöÑÂ†ÜÂÜÖÂ≠òÔºå‰∏çË¶ÅËΩªÊòìÂú®Ëá™Â∑±ÁöÑÁ¨îËÆ∞Êú¨‰∏äËøêË°åÂì¶ üòÇ -XX:MaxDirectMemorySize=15g ÈªòËÆ§ÁöÑÊúÄÂ§ßÂ†ÜÂ§ñÂÜÖÂ≠ò‰∏∫ 15gÔºånio ÈÄöËøáÂÜÖÂ≠òÊò†Â∞ÑÊñá‰ª∂ÊâÄÊèêÈ´ò IO ÊïàÁéáËÄåÁî®„ÄÇ JAVA_OPT_EXT ËØ•ÁéØÂ¢ÉÂèòÈáèÂèØ‰ª•ËøΩÂä†ÂíåÊõøÊç¢ÂéüÊúâÁöÑÈÖçÁΩÆ Broker Â∫îÁî®ÈÖçÁΩÆËá™ÂÆö‰πâÈÖçÁΩÆÂêØÂä®ÂêØÂä® Broker Êó∂ÂèØ‰ª•Ëá™ÂÆö‰πâÈÖçÁΩÆÔºösh bin/mqbroker -c CONFIG.properties ÈÖçÁΩÆÂèØÈÄâÈ°π Ëé∑ÂèñÂèØÈÖçÁΩÆÈ°πÁöÑÂàóË°®Ôºösh bin/mqbroker -m Ëé∑ÂèñÈÖçÁΩÆÈ°π‰ª•ÂèäÈªòËÆ§ÂÄºÔºösh bin/mqbroker -p Ê∫êÁ†Å‰∏≠ÈÖçÁΩÆÁ±ªÔºöBrokerConfig / NettyServerConfig / NettyClientConfig / MessageStoreConfig ÈÖçÁΩÆÂèÇÊï∞‰ªãÁªç‰ªãÁªçÂá†‰∏™Â∏∏Áî®ÁöÑÔºåÊàñËÄÖËØ¥ÈÄöÂ∏∏ÈúÄË¶ÅÈÖçÁΩÆÁöÑÈÄâÈ°π„ÄÇ namesrvAddr=IP:PORT;IP:PORTÈÖçÁΩÆ NameServer ÁöÑÂú∞ÂùÄÔºåÂ§ö‰∏™Âú∞ÂùÄÈó¥‰ΩøÁî® ; ÈöîÂºÄÔºåËØ•ÈÄâÈ°πÊ≤°ÊúâÈªòËÆ§ÂÄºÔºåÂèØ‰ª•ÂêØÂä®Êó∂ÈÄöËøá -n ÂèÇÊï∞ËÆæÁΩÆ brokerClusterName=DefaultClusterÈÖçÁΩÆ RocketMQ ÈõÜÁæ§ÁöÑÂêçÁß∞ÔºåÈªòËÆ§‰∏∫ DefaultCluster brokerName=broker-aBroker ÁöÑÂêçÁß∞ÔºåÂú®Âêå‰∏Ä NameServer Áæ§‰∏ãÔºåÂè™Êúâ‰ΩøÁî®Áõ∏ÂêåÁöÑ brokerName ÁöÑ Broker ÂÆû‰æãÊâçÂèØ‰ª•ÁªÑÊàê‰∏ª‰ªéÂÖ≥Á≥ª brokerId=0Âú®‰∏Ä‰∏™ Broker Áæ§‰∏ãÔºàÈÉΩ‰ΩøÁî®‰∫ÜÂêåÊ†∑ÁöÑ brokerNameÔºâÔºåÊâÄÊúâÂÆû‰æãÈÄöËøá brokerId Êù•Âå∫ÂàÜ‰∏ª‰ªéÔºå‰∏ªÊú∫Âè™Êúâ‰∏Ä‰∏™ÔºöbrokerId=0ÔºàÈªòËÆ§Ôºâ fileReservedTime=48Ê∂àÊÅØÊï∞ÊçÆÂú®Á£ÅÁõò‰∏ä‰øùÂ≠òÁöÑÊó∂Èó¥ÔºåÂçï‰ΩçÔºöÂ∞èÊó∂ÔºåÈªòËÆ§Ôºö48 deleteWhen=04Âú®ÊåáÂÆöÁöÑÊó∂Èó¥Âà†Èô§ÈÇ£‰∫õË∂ÖËøá‰∫Ü‰øùÂ≠òÊúüÈôêÁöÑÊ∂àÊÅØÔºåÊ†áËØÜÂ∞èÊó∂Êï∞ÔºåÈªòËÆ§ÔºöÂáåÊô® 4 Êó∂ brokerRole=SYNC_MASTERÊúâ‰∏âÁßçÈÄâÈ°πÔºåÂâç‰∏§ËÄÖ‰∏ªË¶ÅÊèèËø∞ Broker ÂÆû‰æãÈó¥ÁöÑÂêåÊ≠•Êú∫Âà∂ SYNC_MASTERBroker Master ÁöÑÈÄâÈ°πÔºåÊ∂àÊÅØÂêåÊ≠•Áªô Slave ‰πãÂêéÊâçËøîÂõûÂèëÈÄÅÊàêÂäüÁä∂ÊÄÅ ASYNC_MASTERBroker Master ÁöÑÈÄâÈ°πÔºå‰∏ª‰ªéÈó¥Ê∂àÊÅØÂêåÊ≠•ÂºÇÊ≠•Â§ÑÁêÜ SLAVEBroker Slave ÁöÑÈÄâÈ°πÔºàÊ≤°ÂæóÈÄâÔºâ flushDiskType=ASYNC_FLUSHÊúâ‰∏§ÁßçÈÄâÈ°πÔºåÂàÜÂà´ÂêåÊ≠•ÊàñÂºÇÊ≠•ÁöÑÂà∑ÁõòÁ≠ñÁï• SYNC_FLUSHÊ∂àÊÅØÂè™ÊúâÂú®ÁúüÊ≠£ÂÜôÂÖ•Á£ÅÁõò‰πãÂêéÊâç‰ºöËøîÂõûÊàêÂäüÁä∂ÊÄÅÔºåÁâ∫Áâ≤ÊÄßËÉΩÔºå‰ΩÜÂèØ‰ª•Á°Æ‰øù‰∏ç‰∏¢Â§±Ê∂àÊÅØ ASYNC_FLUSHÂºÇÊ≠•Âà∑ÁõòÔºåÊ∂àÊÅØÂÜôÂÖ• page_cache ÂêéÂç≥ËøîÂõûÊàêÂäü brokerIP1=127.0.0.1ËÆæÁΩÆ Broker ÂØπÂ§ñÊö¥Èú≤ÁöÑ IPÔºåÈÄöÂ∏∏ Broker ÂêØÂä®Êó∂‰ºöËá™Âä®Êé¢ÊµãÔºå‰ΩÜÊòØÁî±‰∫éÂÆπÂô®ÁéØÂ¢ÉÊàñËÄÖÂ§öÁΩëÂç°ÁöÑÂΩ±ÂìçÔºåÈÄöÂ∏∏ÈúÄË¶ÅÊâãÂä®ËÆæÁΩÆ„ÄÇÈúÄË¶ÅÂ§ö‰∏™Êö¥Èú≤ IP Êó∂ÔºåÂèØ‰ª•‰ΩøÁî® brokerIP2/3/4/... ÁöÑÊñπÂºèÈÖçÁΩÆ listenPort=10911Broker ÂÆû‰æãÁõëÂê¨ÁöÑÁ´ØÂè£Âè∑ storePathRootDir=/home/rocketmq/store-aÂ≠òÂÇ®Ê∂àÊÅØÂíå‰∏Ä‰∫õÈÖçÁΩÆÁöÑÊ†πÁõÆÂΩï ÂèÇËÄÉ RocketMQ on GitHub „ÄäRocketMQ ÂÆûÊàò‰∏éÂéüÁêÜËß£Êûê„ÄãÊú∫Ê¢∞Â∑•‰∏öÂá∫ÁâàÁ§æ Êù®ÂºÄÂÖÉ]]></content>
      <categories>
        <category>RocketMQ</category>
      </categories>
      <tags>
        <tag>MQ</tag>
        <tag>RocketMQ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[RocketMQ ÈÖçÁΩÆÊé¢Á¥¢]]></title>
    <url>%2F2018%2F07%2F28%2FRocketMQ-%E9%85%8D%E7%BD%AE%E6%8E%A2%E7%B4%A2%2F</url>
    <content type="text"><![CDATA[ÁõÆÂâçË¢´ÂπøÊ≥õ‰ΩøÁî®ÁöÑ MQ ÊúâÂæàÂ§öÔºåÂåÖÊã¨ ActiveMQÔºåKafkaÔºåRabbitMQÔºåRocketMQ Á≠âÁ≠âÔºåÂÆÉ‰ª¨ÂêÑÊúâÈïøÁü≠„ÄÇËÄåËøëÊúüÊâÄÂú®È°πÁõÆÈÄâÊã©‰∫Ü RocketMQ ‰Ωú‰∏∫Ê∂àÊÅØ‰∏≠Èó¥‰ª∂ÔºåÊ≠§ÂâçÂπ∂Êú™Á≥ªÁªüÂú∞‰∫ÜËß£Á†îÁ©∂ÔºåÊâÄ‰ª•Ë∂ÅÊ≠§Êú∫‰ºöÊï¥ÁêÜ‰∫Ü‰∏Ä‰∫õÁ¨îËÆ∞ÂíåÊÉ≥Ê≥ï„ÄÇ ‰ºòÂäøÁÆÄÂçïÂú∞ËØ¥‰∏Ä‰∏ãÂú®Ëøô‰πàÂ§öÊ∂àÊÅØ‰∏≠Èó¥‰ª∂‰∏≠ÁöÑÈÄâÂûã‰ºòÂäø„ÄÇ‰Ωú‰∏∫ÈòøÈáåÁöÑÂºÄÊ∫êÈ°πÁõÆÔºåÊÉ≥ÂøÖËøòÊòØÂèØÈù†ÁöÑÔºåÂ∞§ÂÖ∂ÊòØÁªèÂèóËøáÂèåÂçÅ‰∏ÄÁöÑËÄÉÈ™å‰ª§‰∫∫‰ø°Êúç„ÄÇ ÊîØÊåÅ‰∏•Ê†ºÁöÑÊ∂àÊÅØÈ°∫Â∫èÔºõ ÊîØÊåÅ Topic ‰∏é Queue ‰∏§ÁßçÊ®°ÂºèÔºõ ‰∫øÁ∫ßÊ∂àÊÅØÂ†ÜÁßØËÉΩÂäõÔºõ ÊØîËæÉÂèãÂ•ΩÁöÑÂàÜÂ∏ÉÂºèÁâπÊÄßÔºõ ÂêåÊó∂ÊîØÊåÅ Push ‰∏é Pull ÊñπÂºèÊ∂àË¥πÊ∂àÊÅØÔºõ Âü∫Êú¨Ê¶ÇÂøµ ProducerÔºöÊ∂àÊÅØÁîü‰∫ßËÄÖÔºåÁîü‰∫ßÊ∂àÊÅØ„ÄÇ ConsumerÔºöÊ∂àÊÅØÊ∂àË¥πËÄÖÔºåÊ∂àË¥πÊ∂àÊÅØ„ÄÇ Pull ConsumerÔºöÊ∂àË¥πËÄÖÊãâÊ®°ÂûãÁöÑÂÆûÁé∞„ÄÇÈÄöËøá‰∏é Broker Âª∫Á´ãÈïøËøûÊé•Ôºå‰ªé‰∏≠‰∏ªÂä®ÊãâÂèñÊ∂àÊÅØ„ÄÇ Push ConsumerÔºöÊ∂àË¥πËÄÖÊé®Ê®°ÂûãÁöÑÂÆûÁé∞„ÄÇÊú¨Ë¥®‰ªçÁÑ∂ÊòØÂª∫Á´ãÈïøËøûÊé•Ôºå‰ΩÜÊòØÈÄöËøáÊ≥®ÂÜåÁõëÂê¨Âô®ÔºåÂú®Êî∂Âà∞Ê∂àÊÅØÊó∂ÂõûË∞ÉÁõëÂê¨ÊñπÊ≥ï„ÄÇ Producer GroupÔºöÁîü‰∫ßËÄÖÈõÜÂêàÔºåÈÄöÂ∏∏ÂåÖÂê´ÂèëÈÄÅÈÄªËæë‰∏ÄËá¥ÁöÑÊ∂àË¥πËÄÖÔºåÂΩ±Âìç‰∫ãÂä°Ê∂àÊÅØÁöÑÊµÅÁ®ã„ÄÇ Consumer GroupÔºöÊ∂àË¥πËÄÖÈõÜÂêàÔºåÈÄöÂ∏∏ÂåÖÂê´Ê∂àË¥πÈÄªËæë‰∏ÄËá¥ÁöÑÊ∂àË¥πËÄÖÔºåÂΩ±ÂìçÁùÄË¥üËΩΩÂùáË°°ÂíåÈõÜÁæ§Ê∂àÊÅØ„ÄÇ Name ServerÔºöÊ≥®ÂÜåÊúçÂä°Âô®ÔºåÂèØ‰ª•Áî±‰∏ÄÂà∞Â§ö‰∏™Ëøë‰πéÊó†Áä∂ÊÄÅÁöÑËäÇÁÇπÊûÑÊàêÔºåÊâÆÊºîËÄÖÁ±ª‰ºº Zookeeper ÁöÑËßíËâ≤„ÄÇBroker ÂêëÂÖ∂‰∏≠Ê≥®ÂÜåÔºåËÄå Producer Âíå Consumer ÂêëÂÖ∂‰∏≠ÊãâÂèñ Broker Âú∞ÂùÄ„ÄÇ BrokerÔºöÊ†∏ÂøÉÁªÑ‰ª∂Ôºå‰øùÂ≠òÂíåËΩ¨ÂèëÊ∂àÊÅØ„ÄÇ ÊãìÊâëÁªìÊûÑÂ¶Ç‰∏ãÔºö ÂàùÊ¨°‰ΩøÁî®‰∏ãËΩΩRocketMQ ÊòØÁ∫Ø Java ËØ≠Ë®ÄÁöÑÂÆûÁé∞Ôºå‰Ω†ÂèØ‰ª•‰ªé Github ‰∏ä‰∏ãËΩΩÊ∫êÁ†ÅÂπ∂‰ΩøÁî® Maven ËøõË°åÁºñËØëÔºåÂΩìÁÑ∂‰πüÂèØ‰ª•‰ªéÂÆòÁΩëÂÖ•Âè£‰∏ãËΩΩ„ÄÇ ÂêØÂä®Á¨¨‰∏ÄÊ¨°ÂêØÂä®ÔºåÁÆÄÂçïÂú∞ÊµãËØï‰∏Ä‰∏ãÊïàÊûúÔºåËøõÂÖ• bin ÁõÆÂΩïÔºå‰ΩøÁî® nohup ÂêØÂä®‰∏Ä‰∏ã NameServiceÔºö nohup ./mqnamesrv -n 127.0.0.1:9876 &amp; ÁÑ∂ÂêéÂêØÂä®‰∏Ä‰∏ã BrokerÔºö nohup ./mqbroker -n 127.0.0.1:9876 &amp; ËøòÊúâ‰∏Ä‰∏™ mqadmin ‰πüÊòØÂ∏∏Áî®ÁöÑÂ∑•ÂÖ∑ÔºåÂåÖÂê´ÁöÑÁÆ°ÁêÜÂëòÂ∏∏Áî®ÁöÑÂäüËÉΩÔºåÂåÖÂê´Êü•ÁúãÈõÜÁæ§ÂàóË°®ÔºåÊü•Áúã„ÄÅÂà†Èô§‰∏ªÈ¢òÁ≠âÔºåÂèØ‰ª•Áõ¥Êé•ÈÄöËøá ./mqadmin Ëé∑ÂæóÂ∏ÆÂä©„ÄÇ ÊµãËØïÂú® RocketMQ È°∫Âà©ÂêØÂä®‰πãÂêéÔºåËøõË°å‰∏Ä‰∏ãÊµãËØïÂêßÔºåÂø´ÈÄüÁöÑ‰ΩìÈ™å‰∏ÄÊää„ÄÇ‰ªé MavenRepository ÊâæÂà∞ÂØπÂ∫îÁöÑ RocketMQ ÂÆ¢Êà∑Á´ØÔºö123456&lt;!-- https://mvnrepository.com/artifact/org.apache.rocketmq/rocketmq-client --&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.rocketmq&lt;/groupId&gt; &lt;artifactId&gt;rocketmq-client&lt;/artifactId&gt; &lt;version&gt;4.2.0&lt;/version&gt;&lt;/dependency&gt; ÊàñËÄÖÊâìÂºÄÂàöÊâç‰ªé Github ‰∏ä‰∏ãËΩΩÁöÑÊ∫êÁ†ÅÔºåexample Ê®°Âùó‰∏ãÊèê‰æõ‰∫ÜËÆ∏Â§öÊµãËØïÁî®‰æãÔºåÈôÑ‰∏äÁï•ÂæÆÊîπÂä®ÁöÑÁîü‰∫ßËÄÖÂíåÊ∂àË¥πËÄÖ‰ª£Á†ÅÔºö Áîü‰∫ßËÄÖ 123456789101112131415161718192021222324252627282930public static void main(String[] args) throws MQClientException, InterruptedException &#123; DefaultMQProducer producer = new DefaultMQProducer("ProducerGroupName"); producer.setNamesrvAddr("127.0.0.1:9876"); producer.setInstanceName("p001"); // ÂèØ‰ª•ËÆæÂÆöÂ§±Ë¥•ÈáçËØïÊ¨°Êï∞ producer.setRetryTimesWhenSendFailed(3); producer.start(); for (int i = 0; i &lt; 1; i++) &#123; try &#123; Message msg = new Message( "TopicTest1", "TagA", "key113", "Hello world".getBytes(RemotingHelper.DEFAULT_CHARSET)); SendResult sendResult = producer.send(msg); System.out.printf("%s%n", sendResult); QueryResult queryMessage = producer.queryMessage("TopicTest1", "key113", 10, 0, System.currentTimeMillis()); for (MessageExt m : queryMessage.getMessageList()) &#123; System.out.printf("%s%n", m); &#125; &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125; producer.shutdown();&#125; Ê∂àË¥πËÄÖ 1234567891011121314151617181920212223242526public static void main(String[] args) throws InterruptedException, MQClientException &#123; DefaultMQPushConsumer consumer = new DefaultMQPushConsumer("ConsumerGroupName"); // ÊåáÂÆö NameServer ÁöÑÂú∞ÂùÄÔºåÂ§ö‰∏™ NameServer ‰ΩøÁî® ; ÈöîÂºÄ consumer.setNamesrvAddr("127.0.0.1:9876"); consumer.setInstanceName("c001"); // ÊåáÂÆöËÆ¢ÈòÖÁöÑ Topic ‰ª•Âèä TagÔºåÂ§ö‰∏™ Tag ‰ΩøÁî® || ÂàÜÂºÄÔºå* ‰ª£Ë°®ÂÖ®ÈÉ® Tag consumer.subscribe("TopicATest1", "TagA"); // ÂèØ‰ª•ËÆæÂÆöÂºÄÂßãÊ∂àË¥πÁöÑ‰ΩçÁΩÆÔºå‰ªÖÈíàÂØπ Push Consumer consumer.setConsumeFromWhere(ConsumeFromWhere.CONSUME_FROM_FIRST_OFFSET); // ÂèØ‰ª•ËÆæÂÆöÊâπÈáèÊ∂àË¥πÊï∞ÈáèÔºåÈªòËÆ§ 1Ôºå‰∏ç‰øùËØÅÊØèÊ¨°ÁöÑÊï∞ÈáèÔºåËøëÈíàÂØπ Push Consumer consumer.setConsumeMessageBatchMaxSize(1); consumer.registerMessageListener(new MessageListenerConcurrently() &#123; @Override public ConsumeConcurrentlyStatus consumeMessage( List&lt;MessageExt&gt; msgs, ConsumeConcurrentlyContext context) &#123; for (MessageExt msg : msgs) &#123; System.out.println(new String(msg.getBody())); &#125; return ConsumeConcurrentlyStatus.CONSUME_SUCCESS; &#125; &#125;); consumer.start(); System.out.println("Consumer Started.");&#125; Âä®ÊâãËøêË°å‰∏Ä‰∏ãÂêß„ÄÇ ÂÖ≥‰∫éÈÖçÁΩÆ‰∫ãÂÆû‰∏äÔºåÂ§ßÂ§öÊï∞Â∞è‰ºô‰º¥Âú® RocketMQ ÂêØÂä®Êó∂ÈÉΩÊòéÊòæËÉΩÊÑüËßâÁîµËÑëÂç°Âç°ÁöÑÔºåÊòØÂõ†‰∏∫ RocketMQ ÈªòËÆ§ÈúÄÊ±ÇÁöÑÂÜÖÂ≠òÂ§™Â§ß‰∫Ü„ÄÇÈÇ£‰πàÔºåÂ¶Ç‰ΩïÊü•ÁúãÂíå‰øÆËÆ¢ÊâÄÈúÄË¶ÅÁöÑÈÖçÁΩÆÂë¢Ôºü‰πãÂâçÊàë‰ª¨ÈÄöËøá ./mqbroker ÂêØÂä®‰∫Ü BrokerÔºåÈÇ£‰πàÊù•Áúã‰∏Ä‰∏ã mqbroker ÁöÑËÑöÊú¨ÔºåÊ≥®ÊÑèËÑöÊú¨Êú´Â∞æÁöÑÂëΩ‰ª§Ôºö12# ÁúÅÁï• ROCKETMQ_HOME ÁöÑÈÖçÁΩÆsh $&#123;ROCKETMQ_HOME&#125;/bin/runbroker.sh org.apache.rocketmq.broker.BrokerStartup $@ ËøôÈáåÂ∞ÜÂêØÂä®ÂëΩ‰ª§ËΩ¨ÁßªÁªô‰∫Ü runbroker.sh ËøõË°åÊâßË°å„ÄÇ JVM ÂèÇÊï∞ÈÖçÁΩÆÊó¢ÁÑ∂Â¶ÇÊ≠§ÔºåÁªßÁª≠Êü•Áúã‰∏Ä‰∏ã runbroker.shÔºö12345678910111213141516171819202122232425262728293031323334353637383940414243444546#!/bin/sh#===========================================================================================# Java Environment Setting#===========================================================================================error_exit ()&#123; echo "ERROR: $1 !!" exit 1&#125;[ ! -e "$JAVA_HOME/bin/java" ] &amp;&amp; JAVA_HOME=$HOME/jdk/java[ ! -e "$JAVA_HOME/bin/java" ] &amp;&amp; JAVA_HOME=/usr/java[ ! -e "$JAVA_HOME/bin/java" ] &amp;&amp; error_exit "Please set the JAVA_HOME variable in your environment, We need java(x64)!"export JAVA_HOMEexport JAVA="$JAVA_HOME/bin/java"export BASE_DIR=$(dirname $0)/..export CLASSPATH=.:$&#123;BASE_DIR&#125;/conf:$&#123;CLASSPATH&#125;#===========================================================================================# JVM Configuration#===========================================================================================JAVA_OPT="$&#123;JAVA_OPT&#125; -server -Xms8g -Xmx8g -Xmn4g"JAVA_OPT="$&#123;JAVA_OPT&#125; -XX:+UseG1GC -XX:G1HeapRegionSize=16m -XX:G1ReservePercent=25 -XX:InitiatingHeapOccupancyPercent=30 -XX:SoftRefLRUPolicyMSPerMB=0 -XX:SurvivorRatio=8 -XX:+DisableExplicitGC"JAVA_OPT="$&#123;JAVA_OPT&#125; -verbose:gc -Xloggc:/dev/shm/mq_gc_%p.log -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:+PrintGCApplicationStoppedTime -XX:+PrintAdaptiveSizePolicy"JAVA_OPT="$&#123;JAVA_OPT&#125; -XX:+UseGCLogFileRotation -XX:NumberOfGCLogFiles=5 -XX:GCLogFileSize=30m"JAVA_OPT="$&#123;JAVA_OPT&#125; -XX:-OmitStackTraceInFastThrow"JAVA_OPT="$&#123;JAVA_OPT&#125; -XX:+AlwaysPreTouch"JAVA_OPT="$&#123;JAVA_OPT&#125; -XX:MaxDirectMemorySize=15g"JAVA_OPT="$&#123;JAVA_OPT&#125; -XX:-UseLargePages -XX:-UseBiasedLocking"JAVA_OPT="$&#123;JAVA_OPT&#125; -Djava.ext.dirs=$&#123;BASE_DIR&#125;/lib"#JAVA_OPT="$&#123;JAVA_OPT&#125; -Xdebug -Xrunjdwp:transport=dt_socket,address=9555,server=y,suspend=n"JAVA_OPT="$&#123;JAVA_OPT&#125; $&#123;JAVA_OPT_EXT&#125;"JAVA_OPT="$&#123;JAVA_OPT&#125; -cp $&#123;CLASSPATH&#125;"numactl --interleave=all pwd &gt; /dev/null 2&gt;&amp;1if [ $? -eq 0 ]then if [ -z "$RMQ_NUMA_NODE" ] ; then numactl --interleave=all $JAVA $&#123;JAVA_OPT&#125; $@ else numactl --cpunodebind=$RMQ_NUMA_NODE --membind=$RMQ_NUMA_NODE $JAVA $&#123;JAVA_OPT&#125; $@ fielse $JAVA $&#123;JAVA_OPT&#125; $@fi ÈÄöËøáËøô‰∏™Êñá‰ª∂ÂèØ‰ª•Ëé∑ÂæóÂæàÂ§ö‰ø°ÊÅØÔºö RocketMQ ÁöÑ JVM ÈÖçÁΩÆ‰ø°ÊÅØ ÈúÄÊ±ÇÁöÑÂÜÖÂ≠òÁ©∫Èó¥ËææÂà∞‰∫Ü 8gÔºåÂ£∞ÊòéÁöÑÊúÄÂ§ßÂ†ÜÂ§ñÂÜÖÂ≠òËææÂà∞‰∫Ü 15gÔºåËøôÂ∞±ÊòØÁîµËÑëÂèòÂæóÂç°Âç°ÁöÑÁöÑÂéüÂõ†‰∫Ü„ÄÇ ÂèØ‰ª•Âú®ÂêØÂä®Êó∂ÈÖçÁΩÆ JAVA_OPT_EXT ÂèòÈáèÊù•ÈÖçÁΩÆÈ¢ùÂ§ñÁöÑÂèÇÊï∞ÊàñËÄÖË¶ÜÁõñÈªòËÆ§ÈÖçÁΩÆ„ÄÇ ÁªìÂêà mqbroker.sh ÂèØ‰ª•ÂèëÁé∞ÔºåÊúÄÁªà‰ΩøÁî®‰∫Ü BrokerStartup Êù•ÂêØÂä® RocketMQÔºåÂëΩ‰ª§Ë°å‰∏≠ÁöÑÂèÇÊï∞ÂêåÊó∂‰ºöË¢´‰º†ÈÄí„ÄÇ Broker ÂÆû‰æãÈÖçÁΩÆÈÇ£‰πàÊé•‰∏ãÊù•Â∞±Âéª BrokerStartup Êü•Áúã‰∏Ä‰∏ã RocketMQ ÁöÑÂêØÂä®ËøáÁ®ã„ÄÇÁî±‰∫éËøô‰∏™Êñá‰ª∂ÂÆûÂú®ÊòØÂ§™ËøáÂÜóÈïøÔºåËøôÈáå‰∏çÂÜçË¥¥Âá∫ÔºåÊÑüÂÖ¥Ë∂£ÁöÑÂ∞è‰ºô‰º¥ËØ∑Ëá™Ë°åÊü•Áúã„ÄÇÂú®Ëøô‰∏™Êñá‰ª∂‰∏≠Ôºå‰∏ªË¶ÅÂØπÂëΩ‰ª§Ë°å‰∏≠Âá†‰∏™ÂÖ∑‰ΩìÂèÇÊï∞ËøõË°å‰∫ÜËß£ÊûêÔºö -mÔºöÂàóÂá∫ÊâÄÊúâÁöÑÈÖçÁΩÆÈ°π -pÔºöÂàóÂá∫ÊâÄÊúâÁöÑÈÖçÁΩÆÈ°π‰ª•ÂèäÈªòËÆ§ÂÄº -cÔºöÊåáÂÆö‰∏Ä‰∏™ properties Êñá‰ª∂ÔºåËØªÂèñÂÖ∂‰∏≠ÁöÑÂÜÖÂÆπË¶ÜÁõñÈªòËÆ§ÈÖçÁΩÆÂπ∂ÊÉÖÂä® Ëá™ÂÆö‰πâÈÖçÁΩÆÊâÄ‰ª•ÔºåÂæàÂ§öÊó∂ÂÄôÁöÑÂÅöÊ≥ïÊòØÈÄöËøá sh mqbroker -p &gt; mqbroker.properties Êù•Ëé∑Âæó‰∏Ä‰ªΩÈªòËÆ§ÈÖçÁΩÆÊñá‰ª∂ÔºàÁΩë‰∏äÁöÑÊñπÊ°àÂèØËÉΩ‰∏çÂ§™ÂáÜÁ°ÆÔºåÂÖ∑‰ΩìËæìÂá∫ÊòØÊê∫Â∏¶ Rocket ÁöÑÊó•Âøó‰ø°ÊÅØÁöÑÔºåÈúÄË¶Å sed ÊàñËÄÖ awk ‰πãÁ±ªÂä†Â∑•Â§ÑÁêÜ‰∏Ä‰∏ãÔºâÔºåÂú®Ê≠§Âü∫Á°Ä‰∏äËøõË°åÈÖçÁΩÆËá™ÂÆö‰πâÔºåÁÑ∂ÂêéÈÄöÂêéÈÄöËøá sh mqbroker -c mqbroker.properties Êù•ËøõË°åÂÆöÂà∂ÂåñÁöÑÂêØÂä®„ÄÇ ÈªòËÆ§ÈÖçÁΩÆÊñπÊ°àÂêåÊó∂Âú® conf ÁõÆÂΩï‰∏ãÔºåÂÆòÊñπ‰πüÁªôÂá∫‰∫ÜÂá†ÁßçÂÖ∏ÂûãÁöÑÈÖçÁΩÆÊñπÊ°à‰æõÂèÇËÄÉÔºö ‰∫å‰∏ª‰∫å‰ªéÂºÇÊ≠•Â§çÂà∂Ôºö2m-2s-async Êñá‰ª∂Â§π„ÄÇËøôÊòØÊúÄÂÖ∏ÂûãÁöÑÁîü‰∫ßÈÖçÁΩÆÔºåÂèå master Ëé∑ÂæóÈ´òÂèØÁî®ÊÄßÔºåÂêåÊó∂‰∏ª‰ªéÈó¥ÁöÑÊï∞ÊçÆÂêåÊ≠•Áî±ÂºÇÊ≠•ÂÆåÊàê„ÄÇ ‰∫å‰∏ª‰∫å‰ªéÂêåÊ≠•Â§çÂà∂Ôºö2m-2s-sync Êñá‰ª∂Â§π„ÄÇÈô§‰∫ÜÂèå master ÁöÑÈÖçÁΩÆÔºå‰∏ª‰ªéÈó¥ÁöÑÊï∞ÊçÆÊòØÂêåÊ≠•ÁöÑÔºå‰πüÂ∞±ÊòØËØ¥Âè™ÊúâÂú®Âêë salve ÊàêÂäüÂêåÊ≠•Êï∞ÊçÆÊâç‰ºöÂêëÂÆ¢Êà∑ÊÆµËøîÂõûÊàêÂäü„ÄÇËøô‰øùËØÅ‰∫ÜÂú® master ÂÆïÊú∫Êó∂ÂÄôÊ∂àÊÅØ‰ªçÁÑ∂ÂèØ‰ª•Ë¢´ÂÆûÊó∂Ê∂àË¥πÔºå‰ΩÜÊòØÊÄßËÉΩÊî∂Âà∞‰∏ÄÂÆöÂΩ±Âìç„ÄÇ ‰∫å‰∏ªÊó†‰ªéÔºö2m-nosalve Êñá‰ª∂Â§π„ÄÇÂèå‰∏ªÊ®°Âºè‰ªÖ‰ªÖ‰øùËØÅ‰∫Ü RocketMQ ÁöÑÈ´òÂèØÁî®ÊÄßÔºåÁÑ∂ËÄåÂú®‰∏ÄÂè∞ master ÂÆïÊú∫ÂêéÔºåÂÆ¢Êà∑Á´ØÊó†Ê≥ïÊ∂àË¥πÈÇ£ÊâπÂú®ÂÆïÊú∫ master ‰∏äÊåÅ‰πÖÂåñÁöÑÊ∂àÊÅØÔºåÁõ¥Âà∞ÂÆïÊú∫ master ÊÅ¢Â§çÊ≠£Â∏∏„ÄÇÂΩìÁÑ∂Ëøô‰∏™ÊñπÊ°àËäÇÁúÅ‰∫ÜÁ°¨‰ª∂ËµÑÊ∫ê„ÄÇ ‰∏âÁßçÈªòËÆ§ÈÖçÁΩÆÊñπÊ°àÈÉΩÊòØÈááÁî®‰∫ÜÂºÇÊ≠•Âà∑ÁõòÔºåÂ∞ΩÁÆ°Âú®Âà∑ÁõòÈó¥ÈöôÂÆïÊú∫‰ºö‰∏¢Â§±Â∞ëÈáèÊï∞ÊçÆÔºå‰ΩÜÊòØÊïàÁéáÊèêÂçáÂèØËßÇ„ÄÇ ÂèÇËÄÉÈÖçÁΩÆÁ±ªBroker ÁöÑÂÖ∑‰ΩìÈÖçÁΩÆÂàÜ‰∏∫‰∫ÜÂÖ∑‰ΩìÁöÑÂõõ‰∏™ÊñπÈù¢Ôºö Broker ÂÆû‰æãÈÖçÁΩÆÔºöÂèÇËÄÉÊ∫êÁ†Å org.apache.rocketmq.common.BrokerConfig Netty ÊúçÂä°Á´ØÈÖçÁΩÆÔºöÂèÇËÄÉÊ∫êÁ†Å org.apache.rocketmq.remoting.netty.NettyServerConfig Netty ÂÆ¢Êà∑Á´ØÈÖçÁΩÆÔºöÂèÇËÄÉÊ∫êÁ†Å org.apache.rocketmq.remoting.netty.NettyClientConfig Message ÊåÅ‰πÖÂåñÈÖçÁΩÆÔºöÂèÇËÄÉÊ∫êÁ†Å org.apache.rocketmq.store.config.MessageStoreConfig ÂÖ≥‰∫é RocketMQ ÁöÑÂêØÂä®ÂíåÈÖçÁΩÆÔºåÂ∞±ÂÖàÂëä‰∏ÄÊÆµËêΩ„ÄÇ]]></content>
      <categories>
        <category>RocketMQ</category>
      </categories>
      <tags>
        <tag>MQ</tag>
        <tag>RocketMQ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ÂÆûÁé∞ MyBatis Êèí‰ª∂]]></title>
    <url>%2F2018%2F07%2F18%2F%E5%AE%9E%E7%8E%B0-MyBatis-%E6%8F%92%E4%BB%B6%2F</url>
    <content type="text"><![CDATA[MyBatis ‰Ωú‰∏∫‰∏Ä‰∏™ÁõÆÂâçÂæàÂ∏∏Áî®ÁöÑÊåÅ‰πÖÂåñÊ°ÜÊû∂ÔºåÊúâÁùÄ‰∏∞ÂØåÁöÑÊãìÂ±ï„ÄÇËøô‰∫õÊãìÂ±ïÂäüËÉΩÂ∏∏Â∏∏‰ª•Êèí‰ª∂ÁöÑÂΩ¢ÂºèÂµåÂÖ•Âà∞ MyBatis ÁöÑËøê‰ΩúÊµÅÁ®ã‰πã‰∏≠ÔºåËÄåÂ¶Ç‰ΩïÂà∂‰ΩúÂÆûÁé∞‰∏Ä‰∏™Êèí‰ª∂ÔºüMyBatis Â∑≤Áªè‰∏∫Â§ßÂÆ∂ËÆæËÆ°Â•Ω‰∫ÜÔºå‰∏Ä‰∏™ Interceptor Êé•Âè£ÔºåÂÆûÁé∞ÂÆÉÂ∞±Â§ü‰∫Ü„ÄÇ Interceptor Êé•Âè£ÁöÑÊã¶Êà™ÁõÆÊ†áÔºåÊòØ MyBatis Ëøê‰ΩúÊµÅÁ®ã‰∏≠ÁöÑÂá†‰∏™Ê†∏ÂøÉÁªÑ‰ª∂Ôºö ExecutorÔºöËøôÊòØ MyBatis ÊâßË°åÂô®ÔºåÊéßÂà∂ÁùÄÊâÄÊúâÂíåÊï∞ÊçÆÂ∫ì‰∫§‰∫íÁöÑÊìç‰ΩúÔºå‰πüÂΩ±ÂìçÁùÄ‰∏ÄÁ∫ßÁºìÂ≠ò„ÄÇ ParameterHandlerÔºöÂèÇÊï∞Â§ÑÁêÜÂô®ÔºåÂú®Êò†Â∞ÑÂèÇÊï∞Êó∂ÂÄôÁîüÊïà„ÄÇ ResultSetHandlerÔºöÁªìÊûúÈõÜÂ§ÑÁêÜÂô®ÔºåÂú®Â§ÑÁêÜÁªìÊûúÈõÜÁöÑÊó∂ÂÄô‰ºöÁî®Âà∞„ÄÇ StatementHandlerÔºöExecutor ‰∏ãÂ±ÇÁöÑÂ§ÑÁêÜÂô®ÔºåÂêåÊ†∑ÊéßÂà∂ÁùÄ SQL Ë°å‰∏∫Ôºå‰πüÊéßÂà∂ÁùÄ‰∫åÁ∫ßÁºìÂ≠òÁöÑÁîüÊïà„ÄÇ ËøôÂá†‰∏™ÁªÑ‰ª∂Â∞±ÁÆÄÁß∞Â§ÑÁêÜÂô®ÂØπË±°ÂêßÔºåÊÑüÂÖ¥Ë∂£ÁöÑËØùÔºåÂèØ‰ª•Ë∑üËøõËµÑÊñôÔºåËøôÈáåÁªßÁª≠Êù•ËÆ≤Êèí‰ª∂Â¶Ç‰ΩïÊã¶Êà™ÂÆÉ‰ª¨‰ª•ÂèäÂ¶Ç‰ΩïÂÆûÁé∞‰∏Ä‰∏™Êèí‰ª∂„ÄÇ Interceptor Êé•Âè£Interceptor Êé•Âè£ÊòØÊèí‰ª∂ÁöÑÊ†∏ÂøÉÔºåÁúã‰∏Ä‰∏ãÂÆÉÁöÑÊé•Âè£Ôºö12345678public interface Interceptor &#123; // Êã¶Êà™ÂêéÁöÑÈÄªËæë Object intercept(Invocation invocation) throws Throwable; // Â∞ÜÂ§ÑÁêÜÂô®ÂØπË±°ÂåÖË£ÖÊàê‰ª£ÁêÜÁ±ª Object plugin(Object target); // ÂàùÂßãÂåñÂ±ûÊÄßËµãÂÄº void setProperties(Properties properties);&#125; intercept()ÔºöÊã¶Êà™ MyBatis ÁöÑÊâßË°åËøáÁ®ãÔºåÈúÄË¶ÅÂú®ÂÖ∂‰∏≠Âä†ÂÖ•ÂÆöÂà∂ÁöÑÈÄªËæë„ÄÇ plugin()ÔºöÂèØ‰ª•ÁêÜËß£‰∏∫Êèí‰ª∂ÁöÑÊûÑÈÄ†ËøáÁ®ãÔºåÈÄöÂ∏∏Êää MyBatis ÁöÑÂá†‰∏™ handler ÂåÖË£ÖÊàê‰ª£ÁêÜÁî®„ÄÇ setProperties()ÔºöÁî®‰∫éÊèí‰ª∂ÂàùÂßãÂåñÊó∂ÂÄôÁöÑÂ±ûÊÄßËµãÂÄº„ÄÇÂ¶ÇÊûú‰Ω†ÊúâÂÖ∂‰ªñÁöÑËµãÂÄºÊñπÊ°àÔºå‰πüÂèØ‰ª•‰∏çÈááÁî®ÂÆÉ„ÄÇ Êàë‰ª¨‰ªéÁ¨¨‰∏Ä‰∏™ÊñπÊ≥ïÂºÄÂßãËÆ≤Ëµ∑„ÄÇ Object intercept(Invocation invocation)ÂÖ•ÂèÇ Invocation ÊòØ‰∏Ä‰∏™ MyBatis Â∞ÅË£ÖÁöÑÂØπË±°ÔºåÂåÖÂê´‰∫ÜËøêË°åÊó∂ÁöÑ‰ø°ÊÅØÔºö Â±ûÊÄßMethod methodÔºöÂç≥ÂèçÂ∞ÑÂåÖ‰∏≠ÁöÑ MethodÔºåÂú®ËøôÈáåÂÆÉÊòØÂΩìÂâçËøêË°åÁöÑÊñπÊ≥ï„ÄÇ Â±ûÊÄßObject[] argsÔºöÊñπÊ≥ïÁöÑÂèÇÊï∞ÂàóË°® Â±ûÊÄßObject targetÔºöËøôÈáåÂÖ∂ÂÆûÊòØ‰Ω†ÈÄâÊã©Êã¶Êà™ÁöÑÂ§ÑÁêÜÂô®ÂØπË±°ÔºàÂÖ≥‰∫éÂ¶Ç‰ΩïÈÄâÊã©Êã¶Êà™ÂÖ∑‰ΩìÁöÑÂ§ÑÁêÜÂô®ÂØπË±°ÔºåÁ®çÂêéÂÜçËø∞ÔºâÔºå‰πüÂ∞±ÊòØËØ¥ÔºåÂÆÉÂèØ‰ª•ÊòØ Executor / StatementHandler ‚Ä¶ÔºåÈúÄË¶Å‰ΩøÁî®Êó∂ÂèØ‰ª•Áõ¥Êé•Âº∫ËΩ¨„ÄÇ ÊñπÊ≥ï proceed()ÔºöËÆ©Â§ÑÁêÜÂô®ÁªßÁª≠ÊµÅÁ®ãÔºåÊàñËÄÖË∞ÉÁî®‰∏ã‰∏Ä‰∏™Êèí‰ª∂Ôºå‰Ω†ÂèØ‰ª•Áî® Filter.doFilter() Êù•Á±ªÊØîÂÆÉ„ÄÇ MyBatis Êèí‰ª∂ÊòØÈÄöËøáÂä®ÊÄÅ‰ª£ÁêÜÂÆûÁé∞ÁöÑÔºåÂØπÂ§ÑÁêÜÂô®ÂØπË±°ËøõË°å‰ª£ÁêÜÔºåÁî±‰ª£ÁêÜÂØπË±°Âú®ÊñπÊ≥ï invoke() ÂâçÂÆåÊàêÊèí‰ª∂‰∏≠ interceptor() ÊñπÊ≥ïÔºàÂç≥Êèí‰ª∂ÈÄªËæëÔºâ„ÄÇÂêåÊó∂Â§ö‰∏™Êèí‰ª∂ÂèàÊòØÂ§öÂ±ÇÁöÑ‰ª£ÁêÜÔºåÊØè‰∏™Êèí‰ª∂ÈÉΩÈúÄË¶ÅÂú®ÂÖ∑‰ΩìÊñπÊ≥ïË∞ÉÁî®ÂâçÂÆåÊàêËá™Â∑±ÁöÑÈÄªËæëÔºåÊâÄ‰ª•Âú®ÂÆûÁé∞ Interceptor Êé•Âè£ÁöÑ intercept ÊñπÊ≥ïÊúÄÂêéÔºå‰∏ÄÂÆöË¶ÅËÆ∞ÂæóÊâßË°å Invocation.proceed()Ôºå‰ª•ÂÆåÊàêÊèí‰ª∂ÁöÑË∞ÉÁî®ÈìæÔºö1234567@Overridepublic Object intercept(Invocation invocation) throws Throwable &#123; // ÂèØ‰ª•ÈÄöËøá invocation Ëé∑ÂæóÂ§ÑÁêÜÂô®ÂØπË±°ÔºåËøõËÄåÂèØ‰ª•ÂèòÊõ¥ÂèÇÊï∞ÔºåÂüãÁÇπÔºåÊî∂ÈõÜ‰ø°ÊÅØÁ≠â // do something // ÊúÄÂêéÈúÄË¶ÅËÆ∞ÂæóÂÆåÊàêË∞ÉÁî®ÈìæÔºåÂê¶ÂàôÊµÅÁ®ãÂ∞Ü‰∏≠ÊÆµ return invocation.proceed();&#125; Object Plugin(Object)ËØ•ÊñπÊ≥ïÂú®Â§ÑÁêÜÂô®ÂØπË±°ÂàùÂßãÂåñÁöÑÊó∂ÂÄôÔºåÁî± InterceptorChain.pluginAll() Ë∞ÉÁî®ÔºåÂ∞ÜÂ§ÑÁêÜÂô®ÂØπË±°ÂåÖË£ÖÊàê‰ª£ÁêÜÁ±ª„ÄÇÂèØ‰ª•ÁêÜËß£‰∏∫‰∏Ä‰∏™ÂàùÂßãÂåñÊñπÊ≥ï„ÄÇ ‰ª• StatementHandler ‰∏æ‰æãÔºö1234567891011121314public StatementHandler newStatementHandler(Executor executor, MappedStatement mappedStatement, Object parameterObject, RowBounds rowBounds, ResultHandler resultHandler, BoundSql boundSql) &#123; StatementHandler statementHandler = new RoutingStatementHandler(executor, mappedStatement, parameterObject, rowBounds, resultHandler, boundSql); // ÂàùÂßãÊó∂Ëß¶Âèë‰ª£ÁêÜÂåÖË£Ö statementHandler = (StatementHandler) interceptorChain.pluginAll(statementHandler); return statementHandler;&#125;public Object pluginAll(Object target) &#123; // Ëø≠‰ª£ÂÆåÊàêÊâÄÊúâÊèí‰ª∂‰ª£ÁêÜÔºåÊúÄÁªàËøîÂõû‰∏Ä‰∏™ÂåÖÂê´ÊâÄÊúâÊèí‰ª∂ÈÄªËæëÁöÑÂ§ÑÁêÜÂô®ÂØπË±°‰ª£ÁêÜ for (Interceptor interceptor : interceptors) &#123; target = interceptor.plugin(target); &#125; return target;&#125; ËØ•ÊñπÊ≥ïÁöÑÊú¨Ë¥®ÁõÆÁöÑÊòØ‰ΩøÂæóÊñ∞ÁöÑ‰ª£ÁêÜÁ±ªÂú®Êã¶Êà™ÁöÑÁõÆÊ†áÊñπÊ≥ï‰ª•Âèä‰πãÂâçÁöÑÊèí‰ª∂ÈÄªËæë‰πãÂâçÊ∑ªÂä†‰∏äÊñ∞Êèí‰ª∂ÁöÑ intercept() ÊñπÊ≥ï‰∏≠ÁöÑÂÜÖÂÆπ„ÄÇÊâÄ‰ª•ËØ•ÊñπÊ≥ï Object Á±ªÂûãÁöÑÂÖ•ÂèÇ‰∏éÂá∫ÂèÇËá™ÁÑ∂‰πüÂ∞±ÊòØÂ§ÑÁêÜÂô®Êé•Âè£ÂØπË±°‰∫Ü„ÄÇÂú®Ê≤°ÊúâÁâπÊÆäÈúÄÊ±ÇÁöÑÊÉÖÂÜµ‰∏ãÔºåÊé®Ëçê‰ΩøÁî®ÂÆòÊñπÂ∑•ÂÖ∑Á±ª Plugin.wrap() ÊñπÊ≥ïÊù•ÂÆåÊàêÔºö1234@Overridepublic Object plugin(Object target) &#123; return Plugin.wrap(target, this);&#125; ÂéüÂõ†Âòõ‚Ä¶ÂÖàÊù•Áúã‰∏Ä‰∏ã Plugin.wrap()Ôºö123456789101112131415161718192021222324252627282930public static Object wrap(Object target, Interceptor interceptor) &#123; // Êèí‰ª∂‰∏äÈÉΩÈÄöËøá @Interceptors ÊåáÂÆö‰∫ÜË¶ÅÊã¶Êà™ÁöÑÂ§ÑÁêÜÂô®Ôºå‰ª•ÂèäË¶ÅÊã¶Êà™ÁöÑÊñπÊ≥ïÂíåÂèÇÊï∞ÔºåÊî∂ÈõÜËµ∑Êù• // Ëé∑ÂæóËøô‰∏™Êèí‰ª∂ÊÉ≥Êã¶Êà™ÁöÑÁ±ª-ÊñπÊ≥ï Map&lt;Class&lt;?&gt;, Set&lt;Method&gt;&gt; signatureMap = getSignatureMap(interceptor); // Ëøô‰∏™ type ÂøÖÁÑ∂ÊòØ 4 Â§ßÊâßË°åÂô®/Â§ÑÁêÜÂô® Êé•Âè£ÂÆûÁé∞‰πã‰∏Ä Class&lt;?&gt; type = target.getClass(); // Ëé∑ÂæóÂéüÊù•ÁöÑÊâÄÂÆûÁé∞ÁöÑÊé•Âè£ÔºåÂä®ÊÄÅ‰ª£ÁêÜÁöÑÂøÖË¶ÅÊ≠•È™§ Class&lt;?&gt;[] interfaces = getAllInterfaces(type, signatureMap); // Â¶ÇÊûúËØ•Êèí‰ª∂Ê≤°ÊúâÊã¶Êà™Ëøô‰∏™Â§ÑÁêÜÂô®ÔºåÂú®‰∏ä‰∏Ä‰∏™ÊñπÊ≥ï‰ºöËøîÂõûÁ©∫Êï∞ÁªÑÔºåËøôÈáåÂ∞±‰∏çÂåÖË£Ö‰∫Ü if (interfaces.length &gt; 0) &#123; return Proxy.newProxyInstance( type.getClassLoader(), interfaces, new Plugin(target, interceptor, signatureMap)); &#125; return target;&#125;@Overridepublic Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123; try &#123; Set&lt;Method&gt; methods = signatureMap.get(method.getDeclaringClass()); if (methods != null &amp;&amp; methods.contains(method)) &#123; return interceptor.intercept(new Invocation(target, method, args)); &#125; return method.invoke(target, args); &#125; catch (Exception e) &#123; throw ExceptionUtil.unwrapThrowable(e); &#125;&#125; Â•ΩÂ§ÑÂú®‰∫éÔºå‰∏çÂú®ÈúÄË¶ÅÂºÄÂèëËÄÖÊâãÂä®ÊûÑÂª∫‰∏Ä‰∏™Âä®ÊÄÅ‰ª£ÁêÜÔºàPlugin Êú¨Ë∫´Â∞±ÊòØ‰∏Ä‰∏™ InvocationHandler ÂÆûÁé∞Á±ªÔºâÔºåÂπ∂‰∏îÂú®ÂåÖË£ÖÊàê‰ª£ÁêÜÁöÑÊó∂ÂÄôÔºåÂ∞ÜÂõõ‰∏™Â§ÑÁêÜÂô®‰∏≠‰∏çÈúÄË¶ÅÊã¶Êà™ÁöÑÁ±ªÊéíÈô§‰∫ÜÔºåËøô‰ΩøÂæóËøêË°å‰∏≠ÂáèÂ∞ë‰∏ÄÂ±Ç‰∏çÂøÖË¶ÅÁöÑ‰ª£ÁêÜÔºåËøõËÄåÊèêÂçáÊïàÁéá„ÄÇ @Intercepts Ê≥®Ëß£Êèí‰ª∂ÁöÑÊã¶Êà™ÊµÅÁ®ãÈÉΩÂ∑≤ÁªèÊòé‰∫ÜÔºåÂõûËøáÊù•Ê¢≥ÁêÜ‰∏Ä‰∏ãÂ¶Ç‰ΩïÊã¶Êà™Ëá™Â∑±ÊÉ≥Ë¶ÅÁöÑÊåáÂÆöÁöÑÂ§ÑÁêÜÂô®ÂíåÊåáÂÆöÁöÑÊñπÊ≥ïÂë¢Ôºü Âú®ÂÆûÁé∞‰∫Ü Interceptor Êé•Âè£‰πãÂêéÔºåÈúÄË¶ÅÈÖçÂêà @Intercpts Ê≥®Ëß£‰∏ÄËµ∑‰ΩøÁî®„ÄÇËøô‰∏™Ê≥®Ëß£‰∏≠ÈúÄË¶ÅÂÆâÁΩÆ‰∏Ä‰∏™ Signature ÂØπË±°ÔºåÂú®ÂÖ∂‰∏≠ÊåáÂÆö‰Ω†ÈúÄË¶ÅÊåáÂÆöÔºö typeÔºöÈÄâÊã© 4 ‰∏™Â§ÑÁêÜÂô®Á±ª‰πã‰∏Ä„ÄÇ methodÔºöÈÄâÊã©‰∫ÜÂ§ÑÁêÜÂô®‰πãÂêéÔºå‰Ω†ÈúÄË¶ÅÈÄâÊã©Êã¶Êà™ÈÇ£‰∫õÊñπÊ≥ï„ÄÇ argsÔºöÈÄâÊã©Êã¶Êà™ÁöÑÊñπÊ≥ïÁöÑÂèÇÊï∞ÂàóË°®„ÄÇÂõ†‰∏∫Â¶Ç Executor ‰∏≠ query ÊñπÊ≥ïÊòØÊúâÈáçËΩΩÁöÑ„ÄÇ ÈÄöËøá‰ª•‰∏ä‰∏âËÄÖÔºåÊèí‰ª∂‰æøÁ°ÆÂÆö‰∫ÜÊã¶Êà™Âì™‰∏™Â§ÑÁêÜÂô®ÁöÑÂì™‰∏™ÊñπÊ≥ï„ÄÇMyBatis ÁöÑÊèí‰ª∂ÂÆûÁé∞ÊòØ‰∏çÊòØÂæàÁÆÄÂçïÂë¢Ôºü ÈúÄË¶ÅÊ≥®ÊÑèÁöÑÊòØÔºåExector Âíå StatementHandler Âú®‰∏Ä‰∫õÂäüËÉΩ‰∏äÁ±ª‰ººÔºå‰ΩÜÊòØ‰ºöÂΩ±Âìç‰∏çÂêåÁ∫ßÂà´ÁöÑÁºìÂ≠òÔºåÈúÄË¶ÅÊ≥®ÊÑè„ÄÇÂêåÊó∂Áî±‰∫é sqlSession ‰∏≠Ëøô 4 ‰∏™Â§ÑÁêÜÂô®ÂØπË±°ÁöÑÂäüËÉΩÁùÄÂÆûÂº∫Â§ßÔºåÂπ∂‰∏îÂèØ‰ª•ÈÄöËøáÊã¶Êà™ÊîπÂèòÊï¥‰∏™ SQL ÁöÑË°å‰∏∫ÔºåÊâÄ‰ª•Â¶ÇÊûúÈúÄË¶ÅÊ∑±ÂÖ•ÂÆöÂà∂Êèí‰ª∂Ë°å‰∏∫ÁöÑÊó∂ÂÄôÔºåÊúÄÂ•ΩÈúÄË¶ÅÂØπ MyBatis Ê†∏ÂøÉÊú∫Âà∂Áî±‰∏ÄÂÆöÁöÑ‰∫ÜËß£„ÄÇ ÂÆòÊñπ‰ªãÁªçhttp://www.mybatis.org/mybatis-3/zh/configuration.html#plugins]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>MyBatis</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Docker ÊåÇËΩΩ‰∏éÊï∞ÊçÆÂ≠òÂÇ®]]></title>
    <url>%2F2018%2F07%2F09%2FDocker%2F</url>
    <content type="text"><![CDATA[Docker ÈïúÂÉèÊòØÂ±ÇÂ±ÇÂàÜÁ¶ªÁöÑÔºåÂàÜ‰∏∫Âè™ËØªÁöÑÂ∫ïÂ±ÇÂíåÂèØËØªÂÜôÁöÑÂΩìÂâçÂ±Ç„ÄÇÂÆπÂô®Âú®ËøêË°åÊó∂ÂÄôÂ¶ÇÊûúÊúâÊñá‰ª∂ÊîπÂä®Ôºå‰ºöËá™Âä®‰ªéÂê´ÊúâËØ•Êñá‰ª∂ÁöÑÂ∫ïÂ±ÇÊã∑Ë¥ùÂπ∂Êõ¥Êñ∞Âú®ÂΩìÂâçÂ±Ç„ÄÇÂ¶ÇÊûúÂÆπÂô®Âú® commit ‰πãÂâçË¢´ÈîÄÊØÅÔºåÈÇ£‰πàÊúâËøô‰∏™ÈïúÂÉèÈáçÊñ∞ÁîüÊàêÁöÑÂÆπÂô®ÊòØ‰∏çÂåÖÂê´ÊîπÂä®ÁöÑÂÜÖÂÆπÁöÑ„ÄÇ ÈúÄÊ±ÇÊù•Ê∫êÊâÄ‰ª•Êï∞ÊçÆÈóÆÈ¢òÊòØ‰ΩøÁî® Docker ÂøÖÁÑ∂‰ºöÂÖ≥Ê≥®Âà∞ÁöÑÔºåÈô§‰∫ÜÂ¶Ç‰ΩïÊåÅ‰πÖÂåñ‰ª•Â§ñÔºåÂ¶Ç‰Ωï‰ªéÂÆø‰∏ªÊú∫ËÆøÈóÆÂà∞ÂÆπÂô®ÂÜÖÁöÑÊï∞ÊçÆÔºüÊàñËÄÖÂ∞ÜÂÆπÂô®ÂÜÖÁöÑÊï∞ÊçÆÂêåÊ≠•Âà∞ÂÆø‰∏ªÊú∫ÔºüÂèàÊàñÊòØÂ§ö‰∏™ÂÆπÂô®Èó¥ÊÄé‰πàÂÖ±‰∫´Êï∞ÊçÆÔºüËøôÈÉΩÊòØË¶ÅÂ§ÑÁêÜÁöÑ„ÄÇ ËøòÂ•Ω Docker Êèê‰æõ‰∫Ü‰∏ÄÂ•óÂÆåÂñÑËÄåÁÆÄÂçïÁöÑÊï∞ÊçÆÊåÇËΩΩÊú∫Âà∂ Volume„ÄÇ ÂëΩÂêçÂç∑Ë¶ÅÊéßÂà∂ÂÆπÂô®ÁöÑÊï∞ÊçÆÂÜÖÂÆπÔºåÈ¶ñÂÖà‰ªéÊñá‰ª∂ÁöÑÊåÇËΩΩÂºÄÂßã„ÄÇdocker volume Êèê‰æõ‰∫Ü‰∏ÄÂ•óÁÆ°ÁêÜÂç∑ÔºàvolumeÔºâÁöÑ APIÔºö12345678910Usage: docker volume COMMANDManage volumesCommands: create Create a volume inspect Display detailed information on one or more volumes ls List volumes prune Remove all unused local volumes rm Remove one or more volumes ÂÖàÂàõÂª∫‰∏Ä‰∏™ named volumeÔºödocker volume create vol‰ΩøÁî® docker volume ls ÂèØ‰ª•ÁúãÂà∞ÂΩìÂâçÂ≠òÂú®ÁöÑÊâÄÊúâÁöÑ volume„ÄÇ‰ΩøÁî® docker volume rm Âà†Èô§ÊåáÂÆöÁöÑ volume„ÄÇ‰ΩøÁî® docker volume inspect vol ÂèØ‰ª•ÁúãÂà∞ÂÆÉÁöÑËØ¶ÊÉÖÔºåÂåÖÊã¨ÂàõÂª∫Êó∂Èó¥ÂíåÂÆø‰∏ªÊú∫‰∏äÁöÑÁúüÊ≠£ÊåÇËΩΩ‰ΩçÁΩÆÁ≠âÔºö [ { &quot;CreatedAt&quot;: &quot;2018-07-09T14:53:05Z&quot;, &quot;Driver&quot;: &quot;local&quot;, &quot;Labels&quot;: {}, &quot;Mountpoint&quot;: &quot;/var/lib/docker/volumes/vol/_data&quot;, &quot;Name&quot;: &quot;vol&quot;, &quot;Options&quot;: {}, &quot;Scope&quot;: &quot;local&quot; } ] ÂèØ‰ª•ÁúãÂà∞Ëøô‰∏™Êñ∞Âª∫ÁöÑ vol ‰øùÂ≠òÂú® /var/lib/docker/volumes/vol/_data ‰∏ãÔºåÂÖ∂‰∏≠ /var/lib/docker/volumes ÁõÆÂΩï‰øùÂ≠ò‰∫ÜÊâÄÊúâÁöÑ Docker volume„ÄÇ ËøêË°åÊó∂ÊåÇËΩΩ‰ΩøÁî®ÂëΩÂêçÂç∑Êúâ‰∫Ü volume ‰πãÂêéÔºåÊàë‰ª¨‰æøÂèØ‰ª•‰ΩøÁî®ÂàöÊâçÂàõÂª∫ÁöÑ vol Êù•ÊåÇËΩΩÂÆπÂô®‰∏≠ÁöÑÊüê‰∏™ÁõÆÂΩïÔºö1docker run -d -v vol:/data --name temp-redis redis Â¶ÇÊ≠§‰∏ÄÊù•ÔºåÂú® temp-redis ÂÆπÂô®‰∏≠ /data ‰∏ãÁöÑÊîπÂä®ÔºåÈÉΩ‰ºöÂêåÊ≠•ÂèçÊò†Âú®ÂÆø‰∏ªÊú∫ÁöÑ /var/lib/docker/volumes/vol/_data ‰∏ãÔºõËÄåÂÆø‰∏ªÊú∫ÁöÑÊîπÂä®‰∫¶ÁÑ∂„ÄÇ ‰ΩøÁî®ÁªùÂØπË∑ØÂæÑ‰ΩøÁî®ÂëΩÂêçÁöÑ volume ÈÄöÂ∏∏ÊòØ‰∏∫‰∫ÜÊï∞ÊçÆÂÖ±‰∫´ÔºåÂæàÂ§öÊó∂ÂÄôÊàë‰ª¨Âè™ÊòØÊÉ≥ÊåáÂÆö‰∏Ä‰∏™ÊåÇËΩΩÁöÑÁõÆÂΩï‰æø‰∫éËÆ∞ÂøÜÂíåÁÆ°ÁêÜÔºåËøô‰∏™Êó∂ÂÄôÂèØ‰ª•‰ΩøÁî®ÁªùÂØπË∑ØÂæÑÔºåÂ¶ÇÔºö1docker run -d -v /data/docker_volume/temp_redis/data:/data --name temp-redis redis Ëá™Âä®ÊåÇËΩΩÊúâÊó∂ÂÄô‰Ω†ÁîöËá≥‰∏çÊÉ≥ÂÖ≥ÂøÉ‰ªª‰Ωï volume ÁöÑÂΩ¢ÂºèÔºå‰Ω†Âè™ÊòØÊÉ≥ÊääÊüê‰∏™ÁõÆÂΩïÊåÅ‰πÖÂåñËÄåÂ∑≤ÔºåÂèØ‰ª•Ëøô‰πàÂÅöÔºö1docker run -d -v /data --name temp-redis redis Docker ‰ºöËá™Âä®ÁîüÊàê‰∏Ä‰∏™ÂåøÂêçÁöÑ volume„ÄÇÊÉ≥Ë¶ÅÁü•ÈÅìÂÖ∑‰ΩìÁöÑÂÆø‰∏ªÊú∫ÁõÆÂΩïÂèØ‰ª•‰ΩøÁî®Ôºödocker inspect Êù•Êü•Áúã„ÄÇËøôÁßçÊÉÖÂÜµÈÄöÂ∏∏Âú®ÊûÑÂª∫Á∫ØÊï∞ÊçÆÂÆπÂô®Êó∂‰ΩøÁî®„ÄÇ Ê≥®ÊÑèÁÇπÂú® volume ÂàõÂª∫Êó∂ÂíåÂàõÂª∫‰πãÂêé‰ªçÁÑ∂ÈúÄË¶ÅÂÖ≥Ê≥®‰ªñ‰ª¨Ôºå‰∏ãÈù¢ÊòØ‰∏Ä‰∫õÂÖ∏ÂûãÁöÑÈóÆÈ¢ò„ÄÇ volume Ëá™Âä®ÂàõÂª∫‰∫ãÂÆû‰∏äÂú® -v vol:/data Êó∂ÂÄôÔºåvol volume ÁîöËá≥‰∏çÈúÄË¶ÅÊèêÂâç‰ΩøÁî® docker volume create vol ÂàõÂª∫Ôºå‰ΩøÁî® docker run -v vol:/data ÂëΩ‰ª§Êó∂‰æø‰ºöËá™Âä®ÂàõÂª∫„ÄÇÂêåÊó∂Âú∞Ôºå‰πüÊÑèÂë≥ÁùÄ -v ÈÄâÈ°π‰∏çÊîØÊåÅÁõ∏ÂØπË∑ØÂæÑÁöÑ‰ΩøÁî®„ÄÇ volume ÁöÑÂà†Èô§Âú®‰∏Ä‰∏™ volume Ë¢´ÂàõÂª∫‰πãÂêéÔºåÊÉ≥Âà†Èô§ÂèØÊ≤°ÈÇ£‰πàÂÆπÊòìÔºåÂç≥‰Ωø‰ΩøÁî®‰∫Ü docker rm CONTAINER Âà†Èô§‰∫ÜÂÆπÂô®Ôºåvolume ‰æùÁÑ∂‰øùÁïôÁùÄ„ÄÇÈô§ÈùûÔºö ‰ΩøÁî® docker run --rm ÂêØÂä®ÁöÑÂÆπÂô®ÂÅúÊ≠¢Êó∂„ÄÇÂÆÉÈô§‰∫Ü‰ºöÂà†Èô§ÂÆπÂô®Êú¨Ë∫´Ëøò‰ºöÂà†Èô§ÊåÇËΩΩÁöÑÂåøÂêç volume„ÄÇ ‰ΩøÁî® docker rm -v v ÂèÇÊï∞ÂèØ‰ª•Âà†Èô§ÂÆπÂô®ÂíåÂàõÂª∫ÂÆπÂô®Êó∂ÂÖ≥ËÅîÁöÑÂåøÂêç volume„ÄÇ ÈÇ£‰πàÊàë‰ª¨Âú®‰ΩøÁî®‰∫Ü named volume ÊàñËÄÖÂà†Èô§ÂÆπÂô®Êó∂ÂøòËÆ∞‰∫Ü -vÔºåÈÇ£‰πàÈÇ£‰∫õÂú® /var/lib/docker/volumes ‰∏ãÁöÑ‰∏Ä‰∫õÊñá‰ª∂Â∞±Êàê‰∫ÜÂÉµÂ∞∏Êñá‰ª∂„ÄÇÊÄé‰πàÂà†Èô§Âë¢Ôºü ‰ΩøÁî® docker volume rm VOLUME Êù•Âà†Èô§„ÄÇ ‰ΩøÁî® docker volume prune Âà†Èô§ÊâÄÊúâ‰∏çÂÜçË¢´‰ΩøÁî®ÁöÑ volume„ÄÇ volume ÁöÑÂè™ËØªÊéßÂà∂‰∏Ä‰∫õÂú∫Âêà‰∏ãÔºåÊàë‰ª¨Êèê‰æõÂè™ÊòØÈúÄË¶ÅÂÆπÂô®ÂÜÖÁöÑÁ®ãÂ∫èÂéªËØªÂèñ‰∏Ä‰∫õÂÜÖÂÆπËÄåÈùû‰øÆÊîπ„ÄÇÊàë‰ª¨ÂèØ‰ª•‰∏•Ê†ºÁöÑÊéßÂà∂ volumeÔºåÂ¢ûÂä†Âè™ËØªÈÄâÈ°π roÔºö1234docker run -d \ --name=nginxtest \ -v nginx-vol:/usr/share/nginx/html:ro \ nginx:latest ÈÄöËøá Dockerfile ÊåÇËΩΩÂèØ‰ª•ÈÄöËøá Dockerfile Âú®ÊûÑÂª∫ÈïúÂÉèÁöÑÊó∂ÂÄô‰æøÊåáÂÆöÈúÄË¶ÅÁöÑ volumeÔºåËøôÂØπ‰∫éÂæàÂ§öÂ∫îÁî®ÈÉΩÊòØÂøÖË¶ÅÁöÑÔºåÂ∞§ÂÖ∂ÊòØ‰∏Ä‰∫õÊï∞ÊçÆÁ±ªÂ∫îÁî®„ÄÇDockerfile ‰∏≠‰ΩøÁî® VOLUME Ë°®ÊòéÊåÇËΩΩÁõÆÂΩïÔºåÂ¶ÇÔºö1VOLUME ["/data1", "/data2"] ‰ªª‰ΩïÈÄöËøáËØ•ÈïúÂÉèÊûÑÂª∫ÁöÑÂÆπÂô®ÈÉΩ‰ºöÂ∞Ü /data1Ôºå/data2 ‰∏§‰∏™ÁõÆÂΩïËøõË°åÊåÇËΩΩ„ÄÇ‰ΩÜÊòØ Dockerfile ÂΩ¢ÂºèÁöÑÂº±ÂäøÊòØÊó†Ê≥ïËøõË°å named volume ÊàñËÄÖÁªùÂØπË∑ØÂæÑÁöÑÊåÇËΩΩ„ÄÇ Êï∞ÊçÆÂÖ±‰∫´‰∏éÂ≠òÂÇ®ÂÖ±‰∫´ volumeÊó¢ÁÑ∂Êï∞ÊçÆÂèØ‰ª•Âú®ÂÆø‰∏ªÊú∫ÂíåÂÆπÂô®Èó¥ÂêåÊ≠•ÔºåÈÇ£‰πàÂèØ‰ª•‰ΩøÂ§ö‰∏™ÂÆπÂô®Èó¥ÂêåÊ≠•ÂêóÔºüÂΩìÁÑ∂ÂèØ‰ª•ÔºÅ ‚Äìvolumes-from1234# È¶ñÂÖàÂàõÂª∫‰∏Ä‰∏™ÂÆπÂô®ÔºåÂπ∂ÊåÇËΩΩ /datadocker run -d -v /data --name ng1 nginx# ÂàõÂª∫Á¨¨‰∫å‰∏™ÂÆπÂô®ÔºåÂÖ±‰∫´ÂâçËÄÖÁöÑ volumedocker run -d --volumes-from ng1 --name gn2 nginx named volume1234# È¶ñÂÖàÂàõÂª∫‰∏Ä‰∏™ÂÆπÂô®ÔºåÂπ∂ÂàõÂª∫ÂëΩÂêçÂç∑ share Êù•ÊåÇËΩΩ /datadocker run -d -v share:/data --name ng1 nginx# ÂàõÂª∫Á¨¨‰∫å‰∏™ÂÆπÂô®Ôºå‰ΩøÁî®ÂêåÊ†∑ÁöÑ /datadocker run -d -v share:/data --name ng2 nginx ‰∏§ÁßçÊñπÂºèÈÉΩËÉΩËææÂà∞Êï∞ÊçÆÂÖ±‰∫´ÁöÑÁõÆÁöÑÔºå‰ΩÜÊòØÁî±‰∫éÈÄöËøáÂëΩÂêçÂç∑ÁöÑÊñπÂºèÂØπÂ§ö‰∏™ÂÆπÂô®ÁöÑ‰æùËµñËøõË°å‰∫ÜËß£ËÄ¶ÔºåÊâÄ‰ª•Êé®ËçêÁ¨¨‰∫åÁßç„ÄÇ Êï∞ÊçÆÂÆπÂô®Ëøô‰∏™ËØùÈ¢ò‰∫ãÂÆû‰∏äÂíåÊï∞ÊçÆÂÖ±‰∫´Á¥ßÂØÜÁõ∏ÂÖ≥ÔºåÁî±‰∫éÂú® Docker1.9 ‰πãÂâçÔºåÂ§ßÂÆ∂ÂπøÊ≥õ‰ΩøÁî®‰ΩøÁî® --volumes-from ÁöÑÂΩ¢ÂºèÊù•ÂÖ±‰∫´Âç∑ÔºåÂØºËá¥ÂøÖÈ°ªË¶Å‰∏Ä‰∏™Â∫ïÂ±ÇÁöÑÊ≤°Êúâ‰æùËµñÁöÑÂÆπÂô®Êù•‰øùÂ≠òÊï∞ÊçÆ„ÄÇ ÈÄöÂ∏∏‰ΩøÁî®ÂíåÂ∫îÁî®ÂÆπÂô®‰∏ÄÊ†∑ÁöÑÈïúÂÉèÊù•ÊûÑÂª∫Êï∞ÊçÆÂÆπÂô® Êï∞ÊçÆÂÆπÂô®‰∏çÈúÄË¶Å‰πü‰∏çÂ∫îËØ•ÂêØÂä®Ôºå‰ªÖ‰ªÖÊòØÂà©Áî® volume Êú∫Âà∂Êù•‰øùÊåÅÊï∞ÊçÆËÄåÂ∑≤ ÁÑ∂ËÄåÁé∞Âú®Êúâ‰∫ÜÂëΩÂêçÂç∑ÔºåÂÆåÂÖ®‰∏çÈúÄË¶ÅÊï∞ÊçÆÂÆπÂô®ÁöÑÂ≠òÂú®‰∫ÜÔºå‰ΩøÁî® named volume ÂèØ‰ª•Êõ¥Áõ¥Êé•Êõ¥Êñπ‰æøÁöÑÁÆ°ÁêÜÂÖ±‰∫´Êï∞ÊçÆ„ÄÇ]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>Docker</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Dockerfile ‰∏≠‰∏â‰∏™ËøêË°åÊåá‰ª§ÁöÑÂ∑ÆÂºÇ]]></title>
    <url>%2F2018%2F07%2F07%2FDockerfile-%E4%B8%AD%E4%B8%89%E4%B8%AA%E8%BF%90%E8%A1%8C%E6%8C%87%E4%BB%A4%E7%9A%84%E5%B7%AE%E5%BC%82%2F</url>
    <content type="text"><![CDATA[Âú®ÊèèËø∞ Dockerfile ÁöÑÊó∂ÂÄôÔºåÂØπ‰∫é RUNÔºåCMDÔºåENTRYPOINT ‰∏â‰∏™ÂëΩ‰ª§ÔºåÁî®Ê≥ïÂçÅÂàÜÁõ∏‰ººÔºåÂäüËÉΩ‰πüÂ∑Æ‰∏çÂ§öÔºåÂÆπÊòìËÆ©‰∫∫Ê∑∑Áî®„ÄÇÂÖ∂ÂÆû‰∏ÄËà¨Êù•ËØ¥Ôºå‰∏â‰∏™ÂëΩ‰ª§ÈÉΩËÉΩÂÆåÊàêÈúÄË¶ÅÁöÑÊìç‰ΩúÔºåËÄåÂ∑ÆÂºÇÁÇπÂ∏∏Â∏∏Ë¢´‰∏Ä‰∫õ‰ΩøÁî®ËÄÖÂøΩÁï•„ÄÇËøôÈáåÁÆÄÂçïËØ¥‰∏Ä‰∏ãÔºå‰∏â‰∏™ÂëΩ‰ª§ÁöÑ‰∏çÂêå‰πãÂ§Ñ„ÄÇ ÂëΩ‰ª§Ê†ºÂºèÈ¶ñÂÖàÁúã‰∏Ä‰∏ã Dockerfile ‰∏≠Â¶Ç‰ΩïÊâßË°åÂëΩ‰ª§„ÄÇÂú® Dockerfile ‰∏≠ÔºåÂëΩ‰ª§ÔºàinstructionÔºâ‰∏ÄËà¨Êúâ‰∏§ÁßçÂÜôÊ≥ïÔºåÂàÜÂà´ÊòØÔºö Shell Ê†ºÂºèÔºöINSTRUCTION &lt;command&gt; &lt;option&gt; &lt;param&gt; Exec Ê†ºÂºèÔºöINSTRUCTION [&quot;command&quot;, &quot;option&quot;, &quot;param&quot;] ‰∏§‰∏™Ê†ºÂºèÂü∫Êú¨Ê≤°ÊúâÂ∑ÆÂºÇÔºåÈô§‰∫ÜÂèØËØªÊÄß‰πãÂ§ñÔºåÂØπ‰∫é Shell Ê†ºÂºèÁöÑÂëΩ‰ª§ÔºåDocker ‰ºöËá™Âä®‰ΩøÁî® /bin/bash -c Êù•ËøõË°åËß£ÊûêÔºåÂèØ‰ª•ÊòØËß£ÊûêÂëΩ‰ª§‰∏≠ÁöÑÂèòÈáèÊØîÂ¶Ç $JAVA_HOME„ÄÇËÄåÂ¶ÇÊûú‰ΩøÁî® Exec Ê†ºÂºèÊâßË°åÊó∂ÈúÄË¶ÅËß£ÊûêÁéØÂ¢ÉÂèòÈáèÔºåÈúÄË¶ÅËøõË°å‰øÆÊîπÔºåÊØîÂ¶ÇÔºöCMD [&quot;/bin/bash&quot;, &quot;-c&quot;, &quot;echo&quot;, &quot;java home is $JAVA_HOME&quot;]„ÄÇÂØπ‰∫é RUNÔºåCMDÔºåENTRYPOINT ‰∏âËÄÖÂêåÊ†∑ÈÅµÂÆàÊ≠§ËßÑÂàô„ÄÇ RUN ÂëΩ‰ª§RUN ÂëΩ‰ª§Âú® Dockerfile ‰∏≠ÂèØ‰ª•Â§öÊ¨°‰ΩøÁî®ÔºåÊâÄ‰ª•ÈÄöÂ∏∏Ë¢´Áî®Êù•Âú®ÊûÑÂª∫ÂÆπÂô®Êó∂ÊâßË°å‰∏Ä‰∫õÂøÖÈ°ªÁöÑÂâçÁΩÆÂëΩ‰ª§ÔºåÊØîÂ¶ÇÂÆâË£ÖËΩØ‰ª∂Á≠â„ÄÇÂÆÉÁöÑÂá∫Áé∞È¢ëÁéáËøúÈ´ò‰∫éÂÖ∂‰ªñ‰∏§‰∏™ÊâßË°åÂëΩ‰ª§„ÄÇÊ†ºÂºèÔºö RUN &lt;command&gt; &lt;option&gt; &lt;param&gt; RUN [&quot;command&quot;, &quot;option&quot;, &quot;param&quot;] Â∏¶Êù•‰∏Ä‰∏™ Shell È£éÊ†ºÁöÑÂÆâË£Ö Git ÁöÑ‰æãÂ≠êÔºö1RUN apt-get update &amp;&amp; apt-get install -y git ËøôÈáå‰ΩøÁî® &amp;&amp; ÂèØ‰ª•‰ΩøÂæóÂú®Âêå‰∏ÄÂ±ÇÈïúÂÉèÂ±Ç‰∏äÊõ¥Êñ∞ apt Âπ∂‰∏ãËΩΩ git„ÄÇ CMD ÂëΩ‰ª§CMD ÂëΩ‰ª§ÁöÑÊ†ºÂºèÊúâ‰∏âÁßçÔºåÂâç‰∏§ËÄÖÈÉΩÊòØÁî®Êù•ÂÆö‰πâÂÆπÂô®ÁöÑÈªòËÆ§Ë°å‰∏∫ÔºåÂêéËÄÖÁî®Êù•Áªô ENTRYPOINT ÂëΩ‰ª§Êèê‰æõÈ¢ùÂ§ñÁöÑÂèØÊõøÊç¢ÂèÇÊï∞„ÄÇ CMD &lt;command&gt; &lt;option&gt; &lt;param&gt; CMD [&quot;command&quot;, &quot;option&quot;, &quot;param&quot;] CMD [&quot;param&quot;...] ÂÖàËØ¥Ââç‰∏§ËÄÖÁî®‰ΩúÊâßË°åÈªòËÆ§ÂëΩ‰ª§ÁöÑÊÉÖÂÜµÔºå‰ª•‰∏Ä‰∏™ÂÆòÊñπ Nginx ÁöÑ Dockerfile ‰∏∫‰æãÔºö12# ÂâçÁΩÆÊ≠•È™§ÂøΩÁï•CMD ["nginx", "-g", "daemon off;"] ËØ•ÂëΩ‰ª§‰ΩøÂæó‰ª•ËØ• Nginx ÈïúÂÉèÊûÑÂª∫ÁöÑÂÆπÂô®ÔºåÂú®ÂêØÂä®Êó∂ÂÄôÈªòËÆ§Âú∞Ëá™Âä®ËøêË°å Nginx„ÄÇ‰ΩÜÊòØÊó¢ÁÑ∂ÊòØÂÆö‰πâÈªòËÆ§Ë°å‰∏∫ÔºåÈÇ£‰πàÂÆÉÊòØÂèØ‰ª•Âú®ËøêË°åÂÆπÂô®ÁöÑÊó∂ÂÄôË¢´Êõ¥ÊîπÁöÑÔºåÊØîÂ¶ÇÂÉè‰∏ãÈù¢ËøôÊ†∑Ôºö1sudo docker run -p 80:80 nginx echo hello-world ÈÇ£‰πàËøô‰∏™Êó∂ÂÄôÂÆπÂô®Âπ∂‰∏ç‰ºöÂêØÂä®‰∏Ä‰∏™ Nginx ÊúçÂä°ÔºåËÄåÊòØÊâìÂç∞‰∫Ü hello-world„ÄÇÂπ∂‰∏îËøô‰∏™ÂÆπÂô®‰ºöÈöèÁùÄÊâìÂç∞ÂëΩ‰ª§ÁöÑÁªìÊùüËÄåÂÅúÊ≠¢„ÄÇ ÈúÄË¶ÅÊ≥®ÊÑèÁöÑÊòØÔºåÊó¢ÁÑ∂ CMD ÂÆö‰πâÈªòËÆ§Ë°å‰∏∫ÔºåÈÇ£‰πàÂÆÉÂú® Dockerfile ‰∏≠Âè™ËÉΩÂ≠òÂú®‰∏Ä‰∏™ÔºàÂ¶ÇÊûúÂÆö‰πâ‰∫ÜÂ§ö‰∏™ CMDÔºåÈÇ£‰∏™ÊúÄÂêé‰∏Ä‰∏™ÊúâÊïàÔºâ ÈÇ£‰πàÂ¶Ç‰Ωï‰ΩøÁî® CMD ‰∏∫ ENTRYPOINT Êèê‰æõÈ¢ùÂ§ñÂèÇÊï∞Âë¢ÔºüÂÖàÁúã‰∏Ä‰∏ã ENTRYPOINT ÁöÑÁî®Ê≥ï„ÄÇ ENTRYPOINT ÂëΩ‰ª§ENTRYPOINT ÈÄöÂ∏∏Áî®Êù•ÂÆö‰πâÂÆπÂô®ÂêØÂä®Êó∂ÂÄôÁöÑË°å‰∏∫ÔºåÊúâÁÇπÁ±ª‰ºº‰∫é CMDÔºå‰ΩÜÊòØÂÆÉ‰∏ç‰ºöË¢´ÂêØÂä®ÂëΩ‰ª§‰∏≠ÁöÑÂèÇÊï∞Ë¶ÜÁõñ„ÄÇ‰∏ä‰∏ÄËäÇ‰∏≠ Nginx ÁöÑ‰æãÂ≠êÔºåÂ¶ÇÊûúÂ∞Ü CMD ÊîπÊàê ENTRYPOINTÔºåÈÇ£‰πàÊàë‰ª¨ÁöÑ hello-world ÊñπÊ°à‰æøË°å‰∏çÈÄö‰∫Ü„ÄÇ ENTRYPOINT ÂêåÊ†∑ÊîØÊåÅ‰∏§ÁßçÊ†ºÂºèÁöÑÂÜôÊ≥ïÔºåÂπ∂‰∏îÊòØÂ≠òÂú®Â∑ÆÂºÇÁöÑÔºàÂêéÊñáÊèèËø∞ÔºâÔºö ENTRYPOINT &lt;command&gt; &lt;option&gt; &lt;param&gt; ENTRYPOINT [&quot;command&quot;, &quot;option&quot;, &quot;param&quot;] ‰ΩøÁî® Exec È£éÊ†ºÁöÑÂÜôÊ≥ïÊîØÊåÅ‰ΩøÁî® CMD ÊãìÂ±ïÂèØÂèòÂèÇÊï∞ÂíåÂä®ÊÄÅÊõøÊç¢ÂèÇÊï∞ÔºåËÄå‰ΩøÁî® Shell È£éÊ†ºÊó∂‰∏çÊîØÊåÅ„ÄÇÂÅáÂ¶ÇÊàë‰ª¨Âú® Dockerfile ‰∏≠Ôºö12# ÂâçÁΩÆÊ≠•È™§ÂøΩÁï•ENTRYPOINT redis-cli -h 127.0.0.1 ÈÇ£‰πàËøô‰∏™Áî±Ê≠§ÊûÑÂª∫ÁöÑÂÆπÂô®Âú®ËøêË°åÊó∂Âè™ËÉΩÂ∞Ü redi ËøûÊé•Âà∞ÂÆπÂô®Êú¨Ë∫´ÁöÑ redis-server ‰∏ä„ÄÇ‰øÆÊîπËøô‰∏™ DockerfileÔºö123# ÂâçÁΩÆÊ≠•È™§ÂøΩÁï•ENTRYPOINT ["redis-cli"]CMD ["-h", "127.0.0.1"] ËøôÊó∂ÂÄôÔºåÂ¶ÇÊûúÊåâÈªòËÆ§ÁöÑÂêØÂä®ÊñπÂºèÔºåÂÆπÂô®ÁöÑ redis-cli ‰ºöËá™Âä®ËøûÊé• 127.0.0.1ÔºåÂç≥‰ª•‰∏ãÂëΩ‰ª§Ê≠§Êó∂ÊòØÁ≠â‰ª∑ÁöÑÔºö12docker run my-redis-imagedocker run my-redis-image -h 127.0.0.1 ‰ΩÜÊòØÁî±‰∫é Dockfile ‰∏≠‰ΩøÁî®‰∫Ü Exec Ê†ºÂºèÁöÑ ENTRYPOINTÔºåÊàë‰ª¨Â∑≤ÁªèÂèØ‰ª•‰øÆÊîπÂÆÉÁöÑÁõÆÊ†áÂú∞ÂùÄ‰∫ÜÔºåÁîöËá≥ÂèØ‰ª•Â¢ûÂä†È¢ùÂ§ñÁöÑÂèÇÊï∞Ôºö1docker run my-redis-image -h server.address -a redis_password ÂÖ∂‰∏≠ -h server.address ÊõøÊç¢‰∫Ü CMD [&quot;-h&quot;, &quot;127.0.0.1&quot;]ÔºåËÄå -a redis_password ÂàôÊòØÁî±‰∫é‰ΩøÁî®‰∫Ü Exec Ê†ºÂºèÂèØ‰ª•Â¢ûÂä†ÂèÇÊï∞„ÄÇ ÂÖ≥‰∫é RUNÔºåCMDÔºåENTRYPOINT ÁöÑÂ∑ÆÂºÇÂ∑≤ÁªèÊèèËø∞ÂÆå‰∫ÜÔºåÊúâÊ≤°ÊúâÈÉΩÁâ¢ËÆ∞‰∫éÂøÉÂë¢~]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>Docker</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ÊñáÂ≠óÂ§ÑÁêÜ-sed]]></title>
    <url>%2F2018%2F07%2F03%2F%E6%96%87%E5%AD%97%E5%A4%84%E7%90%86-sed%2F</url>
    <content type="text"><![CDATA[sed ÊòØÈùûÂ∏∏Â∏∏Áî®ÁöÑÊµÅÂºèÂ§ÑÁêÜÁºñËæëÂ∑•ÂÖ∑ÔºåÈÖçÂêàÊ≠£ÂàôË°®ËææÂºèÂèØ‰ª•ËøõË°åÂçÅÂàÜÊïàÁéáÁöÑÊñáÂ≠óÂ§ÑÁêÜ„ÄÇÂÆÉÈÄöËøáÈÄêË°åÂú∞Â∞ÜÊñáÂ≠óËØªÂèñÔºåÊöÇÂ≠òËøõÊ®°ÂºèÁ©∫Èó¥ÔºåÈÄöËøáÊåáÂÆöÁöÑÂëΩ‰ª§ËøõË°åÂ§ÑÁêÜÂêéÔºåËæìÂá∫Ëá≥Ê†áÂáÜËæìÂá∫ÔºåÁõ¥Âà∞Êñá‰ª∂ÊàñËÄÖËØ¥ËæìÂÖ•ÁöÑÁªìÊùü„ÄÇÂéüÁêÜÂçÅÂàÜÁÆÄÂçïÔºåÊù•Â≠¶‰π†‰∏Ä‰∏ãÂêß„ÄÇ ÂëΩ‰ª§Ê†ºÂºèsed [ÈÄâÈ°πÂèäÂèÇÊï∞]‚Ä¶ ‚ÄòÊìç‰ΩúÂëΩ‰ª§‚Äô Êñá‰ª∂‚Ä¶ Â∏∏Áî®ÈÄâÈ°π -n ÈùôÈªòÊ®°Âºè ÂèñÊ∂à sed ÈªòËÆ§ÁöÑËæìÂá∫ -e Â§öÈáçÁºñËæë ÂèØ‰ª•Â§öÊ¨°‰ΩøÁî®ÔºåÊê∫Â∏¶ sed ÂëΩ‰ª§‰Ωú‰∏∫ËØ•ÈÄâÈ°πÁöÑÂèÇÊï∞ÔºåÂØπ‰∫éÁºìÂÜ≤Âå∫ÁöÑÊØè‰∏ÄË°åÊåâÂëΩ‰ª§È°∫Â∫èËøõË°åÂ§ÑÁêÜ -f ‰ΩøÁî® sed Êìç‰ΩúÁöÑËÑöÊú¨Â§ÑÁêÜÔºåË∑ü‰∏äËÑöÊú¨Êñá‰ª∂ÂêçÂÅöÂèÇÊï∞„ÄÇsed ËÑöÊú¨ÂèØ‰ª•‰øùÂ≠òÂ§öÊù° sed ÂëΩ‰ª§Ôºå‰∏ÄË°å‰∏ÄÊù°Ôºå‰æùÊ¨°ÊâßË°å„ÄÇ -r ‰ΩøÁî®ÊãìÂ±ïÊ≠£ÂàôÔºåÁ±ª‰ºº grep -e ÊàñËÄÖ egrep ÁöÑÂ¢ûÂº∫ÔºåËÆ©‰∫∫Â∞ë‰∫õ‰∏ÄÁÇπËΩ¨‰πâÁ¨¶ -i ÂéüÂú∞‰øÆÊîπÔºåËØ•ÈÄâÈ°π‰ºö‰ΩøÂæó sed ÂëΩ‰ª§Áõ¥Êé•‰øÆÊîπÂéüÊñá‰ª∂ÔºåÂèØ‰ª•Á¥ßË∑ü‰∏Ä‰∏™ÂêéÁºÄÂ¶Ç -i.bkÔºåÂêåÊó∂ÁîüÊàêÂ§á‰ªΩ ÂëΩ‰ª§ÁªÑÊàêsed ÂëΩ‰ª§ÁöÑÁªÑÊàêÈÄöÂ∏∏ÊòØ ‚ÄòË°åÈÄâÊã©ÂÖ∑‰ΩìÊìç‰Ωú‚Äô„ÄÇsed Âú®ËØªÂÖ•Ë°åÂÜÖÂÆπ‰πãÂêéÔºåÂ¶ÇÊûúÂåπÈÖçÂÆöÂùÄË¶ÅÊ±ÇÂ∞±‰ºöËøõË°åÂëΩ‰ª§Êìç‰Ωú„ÄÇÊàë‰ª¨Êù•‰∏§ÈÉ®ÂàÜÂàÜÂºÄ‰∏ÄÁúã~ Ë°åÈÄâÊã© num ÈÄâÊã©Á¨¨ num Ë°å„ÄÇ start,end ÈÄâÊã©Á¨¨ start Ë°åËá≥Á¨¨ end Ë°å„ÄÇ start~step ‰ªé start Ë°åÂºÄÂßãÔºå‰ª• step ‰∏∫Ê≠•ÈïøÈÄâÊã©Ë°å„ÄÇ /pattern/ ÈÄâÊã©Âê´ÊúâËØ•Ê≠£ÂàôÁöÑÂÜÖÂÆπÁöÑË°å„ÄÇ start,/pattern/ ‰ªé start Ë°åÂºÄÂßãÁõ¥Âà∞È¶ñÊ¨°ÊàêÂäüÂåπÈÖçË°®ËææÂºèÁöÑ‰∏ÄË°åÂ∞ÜË¢´ÈÄâÂÆöÔºåÊ≥®ÊÑè sed ÁöÑÂ§ÑÁêÜÊú∫Âà∂ÔºåÂ¶ÇÊûúË°®ËææÂºèÊúÄÁªàÊó†Ê≥ïÊúâ‰ªª‰ΩïÂåπÈÖçË°åÔºåÂ∞Ü‰ºöÂØπ start Ë°å‰πãÂêéÁöÑÊâÄÊúâË°åËøõË°åÈÄâÂÆö„ÄÇ /pattern/,end ‰ªéÈ¶ñÊ¨°ÊàêÂäüÂåπÈÖçË°®ËææÂºèÁöÑ‰∏ÄË°åËá≥ end Ë°åÂ∞ÜË¢´ÈÄâÂÆöÔºåÂ¶ÇÊûúÂú®Á¨¨ end Ë°å‰πãÂâçÂ¶ÇÊûúÊ≤°ÊúâÊàêÂäüÂåπÈÖçÂ∞Ü‰ºö‰∏çÊúâË°åË¢´ÈÄâ‰∏≠„ÄÇ ! ÁΩÆ‰∫éË°åÈÄâÊã©Êú´Â∞æÔºåËøõË°åÂèçÈÄâÔºåÂ¶Ç 10,20! Â∞ÜÊéíÈô§ 10 Ëá≥ 20 Ë°å„ÄÇ ÂÖ∑‰ΩìÊìç‰Ωú p ÊâìÂç∞ÁºìÂÜ≤ÂÜÖÂÆπÔºåÈÄöÂ∏∏ÈÖçÂêà -n ÈÄâÈ°πÊµãËØïÊåá‰ª§Ê≠£Á°ÆÊÄß„ÄÇ q ÊèêÂâçÈÄÄÂá∫ sedÔºåÂΩìÂà∞ËææÂåπÈÖçË°åÊàñËÄÖÊåáÂÆöË°åÂ∞±ÈÄÄÂá∫ sed„ÄÇ i\[content] Ë°åÂâçËøΩÂä†ÂÜÖÂÆπÔºåÂ¶ÇÂú®Á¨¨ 1 Ë°åËá≥Á¨¨ 5 Ë°åÔºåÊØèË°å‰πãÂêéÊèíÂÖ•‚Äò===‚ÄôÔºö&#39;1,5i\===&#39;„ÄÇ a\[content] Ë°åÂêéËøΩÂä†ÂÜÖÂÆπ„ÄÇ c\[content] ÊõøÊç¢ÂÜÖÂÆπÔºåÂ¶ÇÊûúÊòØÊâπÈáèÈÄâÊã©ÔºåÂπ∂‰∏çÊòØÂØπÊØèË°åÂÜÖÂÆπËøõË°åÊõøÊç¢ÔºåËÄåÊòØÂØπÊï¥‰ΩìÊõøÊç¢ÊàêÁõ∏Â∫îÂÜÖÂÆπ„ÄÇ d Âà†Èô§„ÄÇ s/pattern/new_chars/[g] ÂØπÈÄâÂÆöÁöÑË°å‰∏≠È¶ñÊ¨°ÂåπÈÖçË°®ËææÂºèÁöÑÂÜÖÂÆπÊõøÊç¢ÊàêÁõÆÊ†áÂ≠óÁ¨¶‰∏≤ÔºåÂ¶ÇÊûúÊú´Â∞æ‰ΩøÁî®‚Äòg‚ÄôÔºåÂèØ‰ª•ÂØπË°å‰∏≠ÊâÄÊúâÂåπÈÖçÂÜÖÂÆπÊõøÊç¢„ÄÇ y/old-char-set/new-char-set ÂØπÈÄâÂÆöË°å‰∏≠ÊâÄÊúâ old-char-set ÂÜÖÁöÑÂ≠óÁ¨¶ÊõøÊç¢ÊàêÁõ∏Â∫îÁöÑÊñ∞ÁöÑÂ≠óÁ¨¶„ÄÇ n ÊèêÂâçËØªÂèñ‰∏ã‰∏ÄËæìÂÖ•Ë°åËá≥ÁºìÂÜ≤Âå∫„ÄÇ r [file-name] Ë°åÂêéËøΩÂä†ÊåáÂÆöÊñá‰ª∂ÂÜÖÂÆπ„ÄÇ w [file-name] Â∞ÜÈÄâÂÆöË°åËæìÂÖ•Ëá≥ÊåáÂÆöÊñá‰ª∂„ÄÇ h Â§çÂà∂ÂåπÈÖçË°åËøõÂÖ•ÊöÇÂ≠òÁ©∫Èó¥„ÄÇ G ÈÖçÂêà h ÂëΩ‰ª§ÔºåÂèñÂá∫ÊöÇÂ≠òÁ©∫Èó¥ÂÜÖÁöÑË°åÔºåÊèíÂÖ•Ëá≥Ê®°ÂºèÁ©∫Èó¥ÁöÑÊú´Â∞æ„ÄÇ x ÈÖçÂêà h ÂëΩ‰ª§Ôºå‰∫§Êç¢ÂΩìÂâçÂåπÈÖçË°åÁöÑÊöÇÂ≠òÁ©∫Èó¥ÂÜÖÁöÑË°å„ÄÇ ÂëΩ‰ª§Âè†Âä†ÈúÄË¶ÅÂ§öÊ¨°‰ΩøÁî® sed Êìç‰ΩúÁöÑÊó∂ÂÄôÔºåÂèØ‰ª•ÊúâËøô‰πà‰∫õÂäûÊ≥ïÔºö ÈÄöËøá {ÂëΩ‰ª§1;ÂëΩ‰ª§2...} ÂèØ‰ª•‰ΩøÁî®‚Äò{}‚ÄôÂ∞ÜÂ§ö‰∏™ÂëΩ‰ª§Êï¥Âêà‰∏ÄÂùóÂÑøÔºå‰∏≠Èó¥‰ΩøÁî®‚Äò;‚ÄôÂàÜÂâ≤ÔºåÁ±ª‰ºº‰ª£Á†ÅÂùóÁöÑË°®Ëææ„ÄÇÂÖ∂‰∏≠Â¶ÇÊûúÂ¶ÇÊûúÂ§ö‰∏™ÂëΩ‰ª§ÁöÑË°åÂÆö‰ΩçÊù°‰ª∂‰∏ÄËá¥ÔºåÂèØ‰ª•Â∞ÜËØ•ÈÉ®ÂàÜÊèêÂá∫ÔºåÂ¶ÇÔºö&#39;{10p;10p}&#39; Á≠â‰∫é &#39;10{p;p}&#39;„ÄÇ ÈÄöËøá -e ÈÄâÈ°πÂ§öÊ¨°ËæìÂÖ• sed ÂëΩ‰ª§„ÄÇ Â∞ÜÂ§ö‰∏™ sed ÂëΩ‰ª§ÈÄêË°åÂÜôÂÖ•Êñá‰ª∂Ôºå‰ΩøÁî® -f ÈÄâÈ°πÊâßË°å sed„ÄÇ È¢ùÂ§ñÊäÄÂ∑ßsed ÂëΩ‰ª§ÂÖ∂ÂÆûÂíåÊ≠£ÂàôË°®ËææÂºèÈÄöÂ∏∏ÈÖçÂêà‰ΩøÁî®ÔºåÊâÄ‰ª•Ëøô‰∏Ä‰∫õÂ∞èÊäÄÂ∑ßÂÖ∂ÂÆûÂíåÊ≠£ÂàôÊúâÂæàÂØÜÂàáÁöÑÂÖ≥Á≥ª„ÄÇÊØîÂ¶ÇÂØπ‰∫é‰∏Ä‰∏™ÁÆÄÂçïÁöÑÊõøÊç¢Êìç‰ΩúÔºåÂ¶Ç s/abc/xyz/ ÊòØÂçÅÂàÜÁÆÄÂçïÁöÑÔºå‰ΩÜÊòØ sed ÊîØÊåÅÊõ¥Â§çÊùÇÁöÑÊìç‰ΩúÔºåÂèØ‰ª•Áî®‰∏Ä‰∫õÁâπÊÆäÊÑè‰πâÁöÑÊìç‰ΩúÁ¨¶Âè∑: &amp; Ë°®Á§∫Ê≠£ÂàôÂåπÈÖçÊàêÂäüÁöÑÂéüÂ≠óÁ¨¶‰∏≤ÂÜÖÂÆπÔºåÂ¶ÇÊÉ≥Ë¶ÅÊõøÊç¢ÊâÄÊúâÊï∞Â≠ó‰∏∫ÂÆÉÁöÑÁôæÂÄçÔºåÂèØ‰ª•‰ΩøÁî® ‚Äòs/[[:digit:]]\+/&amp;00/g‚Äô \num Ëé∑ÂèñÁºìÂ≠òÁöÑÂåπÈÖç‰∏≠ÁºìÂ≠òÁöÑÂ≠óÁ¨¶‰∏≤Ôºånum ÊåáÂÆö‰ΩçÁΩÆÔºàËøôÂèñÂÜ≥‰∫éË°®ËææÂºè‰∏≠‰ΩøÁî®‰∫ÜÂ§öÂ∞ëÊ¨°Â∞èÊã¨Âè∑‚Äò()‚ÄôÔºâ„ÄÇ Â¶ÇÂéªÈô§Êï∞Â≠óÂπ∂Â≠óÊØçÂ§ßÂÜôÔºå‚Äôs/([[:digit:]]\+\)\|\([[:alpha:]]\+\)/\U\2/gp‚Äô Ëé∑ÂèñÂåÖÂê´‰∏ÄÊÆµ ip ÁöÑÊñáÊú¨‰∏≠ ip ÁöÑÂâç‰∏§ÊÆµÂú∞ÂùÄ ‚Äòs/\([0-9]\+\):\([0-9]\+\):[0-9]\+:[0-9]+/\1 \2/p‚Äô \u Â∞ÜÂêéÊñπÁöÑË°®ËææÂºèÁªìÊûúËøõË°åÈ¶ñÂ≠óÊØçÂ§ßÂÜôÂ§ÑÁêÜ \U Â∞ÜÂêéÊñπÁöÑË°®ËææÂºèÁªìÊûúËøõË°åÂ§ßÂÜôÂ§ÑÁêÜ \l Â∞ÜÂêéÊñπÁöÑË°®ËææÂºèÁªìÊûúËøõË°åÈ¶ñÂ≠óÊØçÂ∞èÂÜôÂ§ÑÁêÜ \L Â∞ÜÂêéÊñπÁöÑË°®ËææÂºèÁªìÊûúËøõË°åÂ∞èÂÜôÂ§ÑÁêÜ]]></content>
      <categories>
        <category>shell</category>
      </categories>
      <tags>
        <tag>Regex</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[AQS ÊµÖÊûê]]></title>
    <url>%2F2018%2F07%2F02%2FAQS-%E6%B5%85%E6%9E%90%2F</url>
    <content type="text"><![CDATA[java.util.concurrent ÂåÖ‰∏≠Êèê‰æõ‰∫ÜËÆ∏Â§öÊòìÁî®ËÄåÊúâÊïàÁöÑÂ∑•ÂÖ∑Á±ªÔºåËØ∏Â¶Ç ReentrantLockÔºåCountDownLatchÔºåSemaphore Á≠âÁ≠âÔºåÁªôÊó•Â∏∏ÁöÑÂπ∂ÂèëÁºñÁ®ãÂ∏¶Êù•‰∫ÜËÆ∏Â§ö‰æøÂà©„ÄÇ‰ªñ‰ª¨ÈÉΩ‰ΩøÁî®‰∫ÜÂêåÊ†∑ÁöÑÊ°ÜÊû∂Êù•ÂÆåÊàêÂü∫Êú¨ÁöÑÂêåÊ≠•ËøáÁ®ãÔºöAbstractQueuedSynchronizer ÔºàAQSÔºâÊù•ÂÆûÁé∞Âü∫Êú¨ÂäüËÉΩÔºåÊØîÂ¶ÇËé∑ÂèñËµÑÊ∫êÂíåÈáäÊîæÁöÑÊ≠•È™§„ÄÇ ÁÆÄÂçï‰∫ÜËß£Êà≥ÂºÄ AQS ‰∏ÄËßàÂÖ∂ÁªìÊûÑÔºåÂÖ∂ÂÆûÂÆÉÊú¨Ë∫´Áª¥Êä§‰∫Ü‰∏§‰∏™Ê¶ÇÂøµÔºö stateÔºöÔºàvolatile intÔºâËØ•Â±ûÊÄßÁª¥Êä§‰∫ÜËµÑÊ∫êÁöÑÁä∂ÊÄÅÔºåÊàñËÄÖÊòØÊï∞Èáè„ÄÇ CLH queueÔºö‰∏Ä‰∏™ÂÖàËøõÂÖàÂá∫ÁöÑÁ∫øÁ®ãÁ≠âÂæÖÈòüÂàó„ÄÇËøôÂπ∂‰∏çÊòØ‰∏Ä‰∏™ÂÖ∑‰ΩìÂØπË±°ÔºåËÄåÊòØÈÄöËøáÂÜÖÈÉ®Á±ª Node Êù•Áª¥Êä§ÁöÑ„ÄÇ AQS ÂØπ‰∫é state ÊîØÊåÅ‰∏§ÁßçÊ®°ÂºèÁöÑËµÑÊ∫êÂÖ±‰∫´ÂΩ¢ÂºèÔºö Exclusive-Êéí‰ªñÂºèÔºöËøõÁ®ãÁã¨Âç†ÂΩ¢ÂºèÔºåÂ¶Ç ReentrantLockÔºåMutex ÁöÑÂ∫îÁî®„ÄÇ Share-ÂÖ±‰∫´ÂºèÔºöÊîØÊåÅÂ§öÁ∫øÁ®ãËÆøÈóÆÔºåÂÖ∏ÂûãÁöÑÂ∫îÁî®Âºè CountDownLatch / Semaphore„ÄÇ Â≠êÁ±ªÂÆûÁé∞ AQS Êó∂ÂÄôÂè™ÈúÄË¶ÅÂÆûÁé∞ÂÖ≥‰∫é state ÁöÑËé∑ÂèñÔºàacquireÔºâÂíåÈáäÊîæÔºàreleaseÔºâÊñπÊ°àÂç≥ÂèØÔºåÂåÖÊã¨ÈòüÂàóÁöÑÁª¥Êä§ÔºåÁ∫øÁ®ãÁöÑÂî§ÈÜíÁ≠âÂ∑•‰ΩúÔºåÂ§ßÈÉ®ÂàÜÈÉΩÂú® AQS Áª¥Êä§‰∫Ü„ÄÇ‰∏æ‰∏™Ê†óÂ≠êÔºåÂú®‰ΩøÁî® CountDownLatch ÁöÑÊó∂ÂÄôÔºåÊàë‰ª¨‰ºöÂàùÂßãÂåñ‰∏Ä‰∏™ËÆ°Êï∞ÂÄº n Áî®‰∫éÂØπÂ∫î n ‰∏™Â≠êÁ∫øÁ®ãÔºåËøô‰∏™ n ÂêåÊó∂‰πüÂØπÂ∫î‰∫Ü state ÂÄºÔºåÊØè‰∏ÄÊ¨° countDown() ÁöÑÊó∂ÂÄôÔºå‰ºö‰ΩøÂæó state CAS Âú∞Âáè 1„ÄÇÂú® state ÂΩíÈõ∂ÁöÑÊó∂ÂÄô‰ºö‰ΩøÁî® unpark()Ôºå‰∏ªÁ∫øÁ®ã ‰ªé await() ÂáΩÊï∞ËøîÂõû„ÄÇ Â∑•‰ΩúÊµÅÁ®ãAQS ÁöÑ API Âêå‰∏ÄËà¨ÁöÑÂêåÊ≠•Â∑•ÂÖ∑ API ‰∏ÄÊ†∑ÔºåÈô§‰∫ÜÂØπ‰∫éËµÑÊ∫êÁöÑ acquire / release Êìç‰ΩúÔºåËøòÊèê‰æõÁöÑ‰∫Ü tryAcquire / tryRelease ÁöÑÈùûÈòªÂ°ûÊìç‰Ωú„ÄÇÂêåÊó∂ acquireInterruptibly ÊîØÊåÅÁ∫øÁ®ã‰∏≠Êñ≠„ÄÇÂ¶ÇÊûúÈúÄË¶Å‰ΩøÁî®ÂÖ±‰∫´ÂºèÁöÑÊìç‰ΩúÔºåÈúÄË¶ÅÂÆûÁé∞ÂØπÂ∫îÁöÑ Share Êìç‰ΩúÊñπÊ≥ï„ÄÇ ËµÑÊ∫êËé∑ÂèñÈ¶ñÂÖàÁúã acquire ÊñπÊ≥ïÔºö1234public final void acquire(int arg) &#123; if (!tryAcquire(arg) &amp;&amp; acquireQueued(addWaiter(Node.EXCLUSIVE), arg)) selfInterrupt();&#125; tryAcquire(int)ÔºöÂ∞ùËØïËé∑ÂèñËµÑÊ∫ê addWaiter(Node)Ôºö‰ΩøÁ∫øÁ®ãÔºàNode ÂØπË±°Áª¥Êä§ËøôÁ∫øÁ®ãÂØπË±°ÔºâËøõÂÖ•Á≠âÂæÖÈòüÂàóÔºåÂØπ‰∫é acquire ÊñπÊ≥ï‰ΩøÁî® EXCLUSICE-Êéí‰ªñÊ®°Âºè„ÄÇ acquireQueued(Node, int)ÔºöÂú®Ëøô‰∏ÄÊ≠•È™§‰∏≠Á∫øÁ®ã‰ºöÁ≠âÂæÖÔºåËÄåÂú®Á∫øÁ®ãÂî§ÈÜíÂêé‰ºöÂ∞ùËØïÂú®ËØ•ÊñπÊ≥ïÂÜÖËé∑ÂèñËµÑÊ∫ê„ÄÇ selfInterruptÔºöÁî±‰∫éÁ∫øÁ®ãÂú®Á≠âÂæÖËøáÁ®ã‰∏≠Êó†Ê≥ïÂìçÂ∫î‰∏≠Êñ≠ÔºåÊâÄ‰ª•Âú®Ëé∑ÂèñËµÑÊ∫êÂπ∂ÈÄÄÂá∫ÈòüÂàóÂêéË°•ÂÖÖ‰∏Ä‰∏™‰∏≠Êñ≠„ÄÇ tryAcquire(int) ÊñπÊ≥ïÈªòËÆ§‰ºöÊäõÂá∫Êìç‰Ωú‰∏çÊîØÊåÅÁöÑÂºÇÂ∏∏ÔºåÈúÄË¶ÅÂ≠êÁ±ªÁöÑÂÖ∑‰ΩìÂÆûÁé∞„ÄÇ 123protected boolean tryAcquire(int arg) &#123; throw new UnsupportedOperationException();&#125; addWaiter(Node, int) ÊñπÊ≥ï‰ºöËá™Êóã‰ΩøÁî® CAS ÊñπÂºèÂ∞Ü‰∏Ä‰∏™ Node Âä†ÂÖ•ÈòüÂ∞æ„ÄÇ 1234567891011121314151617181920212223242526272829private Node addWaiter(Node mode) &#123; Node node = new Node(Thread.currentThread(), mode); // Try the fast path of enq; backup to full enq on failure Node pred = tail; if (pred != null) &#123; node.prev = pred; if (compareAndSetTail(pred, node)) &#123; pred.next = node; return node; &#125; &#125; enq(node); return node;&#125;private Node enq(final Node node) &#123; for (;;) &#123; Node t = tail; if (t == null) &#123; // Must initialize if (compareAndSetHead(new Node())) tail = head; &#125; else &#123; node.prev = t; if (compareAndSetTail(t, node)) &#123; t.next = node; return t; &#125; &#125; &#125;&#125; ‰ªé‰∏äÈù¢‰∏§‰∏™ÊñπÊ≥ïÂèØ‰ª•ÁúãÂá∫‰Ωç‰∫éÈòüÂàóÂ§¥ÈÉ®ÁöÑ Node ÂÖ∂ÂÆûÂè™ÊòØ‰∏Ä‰∏™Ê†áËÆ∞ÔºåÂú®ÈòüÂàóÁ¨¨‰∫å‰ΩçÁΩÆÁöÑÊó∂ÂÄôÔºåÁ∫øÁ®ãÂ∑≤ÁªèÂèØ‰ª•Ëé∑ÂèñËµÑÊ∫êÂπ∂ËøõË°åÁõ∏ÂÖ≥‰ªªÂä°‰∫Ü„ÄÇ acquireQueued(Node, int) Êõ¥ÂÖ≥ÈîÆÁöÑ‰∏ÄÊ≠•ÔºåÂú®Ëé∑ÂèñËµÑÊ∫êÂ§±Ë¥•Ôºå Node Â∑≤ÁªèË¢´Âä†ÂÖ•ÈòüÂ∞æ‰πãÂêéÔºåÁ∫øÁ®ãÈúÄË¶ÅËøõÂÖ•Á≠âÂæÖÁä∂ÊÄÅÁ≠âÂæÖË¢´Âî§ÈÜí„ÄÇ 123456789101112131415161718192021final boolean acquireQueued(final Node node, int arg) &#123; boolean failed = true; try &#123; boolean interrupted = false; for (;;) &#123; final Node p = node.predecessor(); if (p == head &amp;&amp; tryAcquire(arg)) &#123; setHead(node); p.next = null; // help GC failed = false; return interrupted; &#125; if (shouldParkAfterFailedAcquire(p, node) &amp;&amp; parkAndCheckInterrupt()) interrupted = true; &#125; &#125; finally &#123; if (failed) cancelAcquire(node); &#125;&#125; shouldParkAfterFailedAcquire(Node, Node) ÊØè‰∏™ËäÇÁÇπÊòØÂê¶ÈúÄË¶ÅÁ≠âÂæÖÈúÄË¶ÅÈòªÂ°ûÂèñÂÜ≥‰∫éÂâçÈ©±ËäÇÁÇπÁöÑÁä∂ÊÄÅ„ÄÇ 1234567891011121314private static boolean shouldParkAfterFailedAcquire(Node pred, Node node) &#123; int ws = pred.waitStatus; if (ws == Node.SIGNAL) return true; if (ws &gt; 0) &#123; do &#123; node.prev = pred = pred.prev; &#125; while (pred.waitStatus &gt; 0); pred.next = node; &#125; else &#123; compareAndSetWaitStatus(pred, ws, Node.SIGNAL); &#125; return false;&#125; ÂâçÈ©±ËäÇÁÇπÊúÄÂêé‰ºöÈÄöËøáËØ•Áä∂ÊÄÅÂÄºÊù•Âà§Êñ≠ÊòØÂê¶ÈúÄË¶Å unpark ‰∏ã‰∏™Á∫øÁ®ã„ÄÇÂú®ËøôÈáåÔºåÂ¶ÇÊûúÂâçÈ©±ËäÇÁÇπÊ†áËØÜ‰∏∫ SIGNALÔºåÂàôËøõÂÖ•Á≠âÂæÖÔºõÊ†áËØÜ‰∏∫ CANCAL ÈúÄË¶ÅËøΩÊ∫ØÊõ¥ÂâçÁöÑËäÇÁÇπÁä∂ÊÄÅÔºõÂ¶ÇÊûú‰∏∫ÂÖ∂‰ªñÊ≠£Â∏∏ÂÄºÔºåÂàôÊõ¥Êñ∞‰∏∫ SIGNAL„ÄÇ parkAndCheckInterrupt() ‰ΩøÁ∫øÁ®ãËøõÂÖ• WATINGÔºåÁ≠âÂæÖ unparkÔºàÂú® release ‰∏≠Ëß¶ÂèëÔºåÈ©¨‰∏äÂ∞±Êù•Ôºâ ÊàñËÄÖ interruptÔºåË¢´Âî§ÈÜíÂêéÂõûÂà∞ acquireQueued Ëß¶Âèë‰∏≠Êñ≠ÊàñËÄÖÁªßÁª≠Ê£ÄÊü•ÊòØÂê¶ÂèØ‰ª•Ëé∑ÂèñËµÑÊ∫ê„ÄÇ 1234private final boolean parkAndCheckInterrupt() &#123; LockSupport.park(this); return Thread.interrupted();&#125; ÈáäÊîæËµÑÊ∫êÂπ∂Âî§ÈÜíÂêéÁΩÆÁ∫øÁ®ãËøôÊòØ acquire ÊñπÊ≥ïÁöÑÂèçÊìç‰ΩúÔºåÁî®‰∫éËµÑÊ∫êÁöÑÈáäÊîæÔºåÂΩìËµÑÊ∫êÊàêÂäüÈáäÊîæÊó∂ÔºåÂî§ÈÜí‰∏ã‰∏Ä‰∏™Á∫øÁ®ãÔºà‰Ωç‰∫éÂ§¥ËäÇÁÇπ‰πãÂêéÔºâ„ÄÇ 123456789public final boolean release(int arg) &#123; if (tryRelease(arg)) &#123; Node h = head; if (h != null &amp;&amp; h.waitStatus != 0) unparkSuccessor(h); return true; &#125; return false;&#125; ÈÄöËøá tryRelease(int) ÊñπÊ≥ïÂà§Êñ≠ËµÑÊ∫êÊòØÂê¶ÈáäÊîæÔºåËøô‰∏™ÊñπÊ≥ïÂêåÊ†∑ÈúÄË¶ÅË¢´ÂÆûÁé∞Ôºö 123protected boolean tryRelease(int arg) &#123; throw new UnsupportedOperationException();&#125; ËÄå unparkSuccessor(Node) ÊñπÊ≥ïÁî®Êù•ÁúüÊ≠£Âî§ÈÜí node.next ‰∏≠ÁöÑÁ∫øÁ®ãÔºö 123456789101112131415private void unparkSuccessor(Node node) &#123; int ws = node.waitStatus; if (ws &lt; 0) compareAndSetWaitStatus(node, ws, 0); Node s = node.next; if (s == null || s.waitStatus &gt; 0) &#123; s = null; for (Node t = tail; t != null &amp;&amp; t != node; t = t.prev) if (t.waitStatus &lt;= 0) s = t; &#125; if (s != null) LockSupport.unpark(s.thread);&#125; ÁúãÂà∞ËøôÂ∞±ËÉΩ‰∫ÜËß£Êï¥‰∏™ AQS ÁöÑËøê‰ΩúÊµÅÁ®ã‰∫Ü„ÄÇÂú® parkAndCheckInterrupt ‰∏≠ËøõÂÖ• WAITING ÁöÑÁ∫øÁ®ãÔºåÂú®ËøôÈáåË¢´Âî§ÈÜíÔºåÂÆÉ‰ºöÁªßÁª≠ËøõÂÖ• acquireQueued ‰∏≠ÁöÑËá™ÊóãÔºåÂ¶ÇÊûú tryAcquire È°∫Âà©Ëé∑ÂæóËµÑÊ∫êÔºåÂàôÂ∞ÜÊú¨Á∫øÁ®ãÁöÑËäÇÁÇπËÆæÁΩÆ‰∏∫ head Âπ∂ËøîÂõû acquire ÊñπÊ≥ï„ÄÇso, go on. AQS Êú¨Ë∫´Âπ∂‰∏çÂ§çÊùÇÔºå‰ΩøÁî®Êó∂Âè™ÈúÄË¶ÅÊâãÂä®ÂÆûÁé∞ tryAcquire Âíå tryRealeas ÊñπÊ≥ï„ÄÇ ËÄåÂØπ‰∫é Share-ÂÖ±‰∫´ÂºèÁöÑ acquire / release ÊµÅÁ®ãÔºåÂå∫Âà´Âπ∂‰∏çÂ§™Â§ßÔºåÊúâÂÖ¥Ë∂£ÁöÑÂ∞è‰ºô‰º¥ÂèØ‰ª•Ëá™Ë°åÁøªÈòÖÊ∫êÁ†Å‰∏ÄÊé¢Á©∂Á´ü„ÄÇ ÂèÇËÄÉ https://mp.weixin.qq.com/s/eyZyzk8ZzjwzZYN4a4H5YA]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Âπ∂Âèë</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Ribbon ÊëòË¶Å]]></title>
    <url>%2F2018%2F07%2F01%2FRibbon%2F</url>
    <content type="text"><![CDATA[‰∏ªË¶ÅÊûÑÊàêRibbon ÊòØÁî± netflix ÂºÄÊ∫êÁöÑ‰∏Ä‰∏™ÂÆ¢Êà∑Á´ØË¥üËΩΩÂùáË°°ÁªÑ‰ª∂„ÄÇ‰ªéÂÆ¢Êà∑Á´ØÁöÑËßíÂ∫¶ÂèñÁª¥Êä§ÊúçÂä°Èó¥ËØ∑Ê±ÇÁöÑË¥üËΩΩÂùáË°°ÔºåÂπ∂ËøõË°å‰∏ÄÂÆöÁöÑÂÆπÈîôÂ§ÑÁêÜ„ÄÇËá™ÁÑ∂ÁöÑÂÆÉÁöÑÊ†∏ÂøÉÊé•Âè£Â∞±ÊòØÔºöcom.netflix.loadbalancer.ILoadBalancer„ÄÇ Âú®ÈÖçÁΩÆ Ribbon ‰πãÂâçÔºå‰∫ÜËß£‰∏Ä‰∏ã Ribbon ÂÆåÊàêË¥üËΩΩÂùáË°°ÁöÑÂá†‰∏™ÈáçË¶ÅÁªÑÊàêÈÉ®ÂàÜÔºö IRuleÔºöË¥üËΩΩÂùáË°°ÁöÑÁ≠ñÁï•„ÄÇ IPingÔºöÊ£ÄÊµãÊúçÂä°Â≠òÊ¥ªÁöÑÁ≠ñÁï•„ÄÇ ServerList&lt;T&gt;ÔºöÊãâÂèñÊúçÂä°ÂÆû‰æãÂàóË°®ÁöÑÁ≠ñÁï•„ÄÇ ServerListUpdaterÔºöÊõ¥Êñ∞ÊúçÂä°ÂàóË°®ÁöÑËß¶ÂèëÁ≠ñÁï•„ÄÇ ServerListFilter&lt;T&gt;ÔºöÊúçÂä°ËøáÊª§ÊñπÊ°à„ÄÇ ÂèÇËÄÉ‰∏ãÈù¢ÁöÑÁ±ªÂÖ≥Á≥ªÂõæÔºåÂèØ‰ª•Êúâ‰∏Ä‰∏™Êõ¥Â•ΩÁöÑÂç∞Ë±°Ôºö IRuleË¥üËΩΩÂùáË°°Á≠ñÁï•Êé•Âè£ÔºåÂèØËÉΩÊúÄÂ∏∏ÈúÄË¶ÅÈÖçÁΩÆÁöÑÂ∞±ÊòØÂÆÉ‰∫ÜÔºåÈÖçÁΩÆ‰πüÊ≤°‰ªÄ‰πàÁâπÊÆäÁöÑÔºåÂ∞±‰ª• Spring Â∏∏Áî®ÁöÑÊñπÂºèÂç≥ÂèØ„ÄÇÈÄöÂ∏∏ÊÉÖÂÜµ‰∏ã Ribbon ÂéüÁîüÁöÑÂá†‰∏™Ë¥üËΩΩÂùáË°°Á≠ñÁï•Â∫îËØ•ÂèØ‰ª•Êª°Ë∂≥Áîü‰∫ßË¶ÅÊ±ÇÔºàÂΩìÁÑ∂‰Ω†‰πüÂèØ‰ª•Ëá™ÂÆö‰πâÔºâÔºåÊù•‰∫ÜËß£‰∏Ä‰∏ãÔºö AbstractLoadBalancerRule È°∂Á∫ßÁöÑÊäΩË±°Á±ªÔºåÁªô‰∫à‰∫ÜËé∑Âæó LoadBalancer ÁöÑÊñπÊ≥ïÔºåÂèØ‰ª•ËÆ©Â≠êÁ±ªËé∑ÂæóË¥üËΩΩÂùáË°°Âô®ÁöÑ‰∏Ä‰∫õ‰ø°ÊÅØÔºåÂÆöÂà∂Êõ¥ÂÖ∑‰ΩìÁöÑÁÆóÊ≥ï„ÄÇ RandomRule ÈÄöËøá LoadBalancer Ëé∑ÂèñÂèØÁî®ÁöÑÊúçÂä°ÂÆû‰æãÔºåÂπ∂ÈöèÊú∫ÊåëÈÄâ„ÄÇÔºà‰∏ÄÁõ¥Êó†ÂèØÂÆû‰æãÊó∂ÊúâÊó†ÈôêÂæ™ÁéØ bugÔºâ RoundRobinRule ÈÄöËøá LoadBalancer Ëé∑ÂèñÂèØÁî®ÁöÑÊúçÂä°ÂÆû‰æãÔºåÂπ∂ËΩÆËØ¢ÈÄâÊã©„ÄÇÔºàË∂ÖËøá 10 Ê¨°Â§±Ë¥•Êó∂ÔºåÊâìÂç∞Êú∫Ë≠¶ÂëäÂπ∂ËøîÂõû nullÔºâ RetryRule ÈªòËÆ§Êúâ‰∏Ä‰∏™ RoundRobinRule ÁöÑÂ≠êËßÑÂàôÔºåÂíå 500 ÊØ´ÁßíÁöÑÈòàÂÄº„ÄÇ‰ΩøÁî®Â≠êËßÑÂàôÈÄâÊã©ÂÆû‰æãÔºåÊâßË°åÊó∂Èó¥Ëã•Ë∂ÖËøáÈòàÂÄºÂàôËøîÂõû null„ÄÇ WeightedResponseTimeRule ÁªßÊâøËá™ RoundRobinRule„ÄÇÂú®ÊûÑÈÄ†Êó∂‰ºöÂêØÂä®‰∏Ä‰∏™ÂÆöÊó∂‰ªªÂä°ÔºåÈªòËÆ§ÊØè 30 ÁßíÊâßË°å‰∏ÄÊ¨°ÔºåÊù•ËÆ°ÁÆóÊúçÂä°ÂÆû‰æãÁöÑÊùÉÈáç„ÄÇÂú®ÈªòËÆ§ÁöÑÁÆóÊ≥ï‰∏ãÔºåÂìçÂ∫îÈÄüÂ∫¶Ë∂äÂø´ÁöÑÊúçÂä°ÂÆû‰æãÊùÉÈáçË∂äÂ§ßÔºåË∂äÂÆπÊòìË¢´ÈÄâÊã©„ÄÇ ClientConfigEnabledRoundRobinRule Êú¨Ë∫´ÂÆö‰πâ‰∫Ü‰∏Ä‰∏™ RoundRobinRule ÁöÑÂ≠êËßÑÂàô„ÄÇÊú¨‰∏îÈªòËÆ§ÁöÑ choose ÊñπÊ≥ï‰πüÊòØÊâßË°å RoundRobinRule ÁöÑÂÆûÁé∞„ÄÇÊú¨Ë∫´Ê≤°ÊúâÁâπÊÆäÁî®Â§ÑÔºåËøô‰∏™ÈªòËÆ§‰ºöÂÆûÁé∞ÊòØÂú®ÂÖ∂Â≠êÁ±ªÁöÑÁÆóÊ≥ïÊó†Ê≥ïÂÆûÁé∞Êó∂ÈááÁî®ÔºåÈÄöÂ∏∏‰ºöÈÄâÊã©ËØ•Á±ª‰ΩúÁà∂Á±ªÁªßÊâøÔºåÂÆûÁé∞Ëá™ÂÆö‰πâÁöÑËßÑÂàôÔºå‰ª•‰øùËØÅÊã•Êúâ‰∏Ä‰∏™ÈªòËÆ§ÁöÑËΩÆËØ¢ËßÑÂàô„ÄÇ BestAvaliableRule ÈÄöËøá LoadBalancerStats ÈÄâÊã©Âπ∂ÂèëËØ∑Ê±ÇÊúÄÂ∞èÁöÑÂÆû‰æã„ÄÇ PredicateBasedRule Âà©Áî®Â≠êÁ±ªÁöÑ Predicate ËøáÊª§ÈÉ®ÂàÜÊúçÂä°ÂÆû‰æãÂêéÈÄöËøáËΩÆËØ¢ÈÄâÊã©„ÄÇ AvailabilityFilteringRule ËΩÆËØ¢ÈÄâÊã©‰∏Ä‰∏™ÊúçÂä°ÂÆû‰æãÔºåÂà§Êñ≠ÊòØÂê¶ÊïÖÈöúÔºàÊñ≠Ë∑ØÂô®Êñ≠ÂºÄÔºâÔºåÂπ∂ÂèëËØ∑Ê±ÇÊòØÂê¶Â§ß‰∫éÈòàÂÄºÔºàÈªòËÆ§2^32-1ÔºåÂèØÈÄöËøá&lt;clientName&gt;.&lt;nameSpace&gt;.ActiveConnectionsLimit ‰øÆÊîπÔºâ„ÄÇÂÖÅËÆ∏ÂàôËøîÂõûÔºå‰∏çÂÖÅËÆ∏ÂàôÂÜçÊ¨°ÈÄâÊã©ÔºåÂ§±Ë¥• 10 Ê¨°ÂêéÊâßË°åÁà∂Á±ªÊñπÊ°à„ÄÇ ZoneAvoidanceRule ‰ΩøÁî®ÁªÑÂêàËøáÊª§Êù°‰ª∂ÊâßË°åËøáÊª§ÔºåÊØèÊ¨°ËøáÊª§Âêé‰ºöÂà§Êñ≠ÂÆû‰æãÊï∞ÊòØÂê¶Â∞è‰∫éÊúÄÂ∞èÂÆû‰æãÊï∞ÔºàÈªòËÆ§1ÔºâÔºåÊòØÂê¶Â§ß‰∫éËøáÊª§ÁôæÂàÜÊØîÔºàÈªòËÆ§0ÔºâÔºå‰∏çÂÜçËøáÊª§Âêé‰ΩøÁî®ËΩÆËØ¢ÈÄâÊã©„ÄÇ ÂÖ∑‰ΩìÈÖçÁΩÆÂú®È°πÁõÆ‰∏≠ÊòØÂèØ‰ª•ÈÖçÁΩÆÂ§ö‰∏™ Ribbon ÂÆ¢Êà∑Á´ØÁöÑÔºåÈÄöÂ∏∏Êù•ËØ¥ÊØè‰∏™ÂÆ¢Êà∑Á´ØÁî®Êù•ËÆøÈóÆ‰∏çÂêåÁöÑÊúçÂä°„ÄÇÊØîÂ¶Ç‰∏∫ËÆøÈóÆ A ÊúçÂä°ÁöÑ Ribbon ÂÆ¢Êà∑Á´ØÈÖçÁΩÆ‰∏∫ A-ClientÔºåB ÊúçÂä°‰∏∫ B-Client„ÄÇ ÈÄöËøá‰ª£Á†ÅÈÖçÁΩÆÈ¶ñÂÖàÊù•‰ªãÁªçÈÄöËøáÊ≥®Ëß£ÈÖçÁΩÆÁöÑÊñπÊ≥ïÔºåÂÉèÁÆÄÂçïÁöÑ Sring Bean ÈÖçÁΩÆ‰∏ÄÊ†∑Ôºå‰∏çËøá‰∏çÈúÄË¶Å‰ΩøÁî® @Configuration Ê≥®Ëß£‰∫Ü„ÄÇÂú®ÈÖçÁΩÆÁ±ª‰∏äÂêØÁî® @RibbonClientÔºåÁªôÂÆöÂÆ¢Êà∑Á´ØÁöÑÂêçÁß∞ÂíåÈÖçÁΩÆÁ±ªÔºå‰ΩøÁî® @Bean Êù•ÈÖçÁΩÆÂÖ∑‰ΩìÁöÑÁªÑ‰ª∂Â¶Ç IRule Á≠â„ÄÇ 123456789101112131415@RibbonClient(name = "A-Client",configuration = ARibbonConfig.class)public class ARibbonConfig &#123; // ÊúçÂä°ÂÆû‰æãÁöÑÂú∞ÂùÄ String listOfServers = "http://127.0.0.1:8081,http://127.0.0.1:8082"; @Bean public ServerList&lt;Server&gt; ribbonServerList() &#123; List&lt;Server&gt; list = Lists.newArrayList(); if (!Strings.isNullOrEmpty(listOfServers)) &#123; for (String s: listOfServers.split(",")) &#123; list.add(new Server(s.trim())); &#125; &#125; return new StaticServerList&lt;Server&gt;(list); &#125;&#125; ÂÆòÊñπÊñáÊ°£‰∏äÊèêÁ§∫‰∫Ü‰∏Ä‰∏™ÂùëÔºå‰∏çËÉΩÊääÂä†‰∫ÜÈÖçÁΩÆÊ≥®Ëß£ÁöÑÂÖ∑‰ΩìÁöÑÈÖçÁΩÆÁ±ªÊîæÂú® @ComponentScan Ë∑ØÂæÑ‰∏ãÔºåÂê¶ÂàôÂÖàÊâ´ÊèèÂà∞ÁöÑ‰∏Ä‰∏™ÂÖ∑‰ΩìÁöÑÂÆ¢Êà∑Á´ØÈÖçÁΩÆ‰ºöÊàê‰∏∫ Ribbon ÁöÑÂÖ®Â±ÄÈÖçÁΩÆ„ÄÇ ËøôÊÄé‰πàËÉΩÂøçÔºüÂΩìÁÑ∂ÂæóÊúâÊõ¥‰ºòÈõÖÁöÑËß£ÂÜ≥ÊñπÂºèÔºöÂÖ®Â±ÄÈÖçÁΩÆÁöÑÊñπÊ°à„ÄÇ‰ΩøÁî® @RibbonClients Ê≥®Ëß£Ôºå‰∏ÄÊ¨°ÂèØ‰ª•ÊèèËø∞Â§ö‰∏™ÂÆ¢Êà∑Á´ØÈÖçÁΩÆÁ±ªÁöÑ‰ΩçÁΩÆÔºåÂêåÊó∂‰πüÂèØ‰ª•ÊåáÂÆöÈªòËÆ§ÈÖçÁΩÆÁ±ªÔºåÂ¶ÇÔºö 12345678910@SpringCloudApplication@RibbonClients(value = &#123; @RibbonClient(name = "A-Client",configuration = ARibbonConfig.class), @RibbonClient(name = "B-Client",configuration = BRibbonConfig.class)&#125;, defaultConfiguration = DefaultConfig.class)public class DemoServiceApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(DemoServiceApplication.class, args); &#125;&#125; ËøôÊ†∑ÈÖçÁΩÆÂèØ‰ª•‰∏çÈúÄË¶ÅÂÜçÂú®ÈÖçÁΩÆÁ±ª‰∏äÂä†‰∏äÊ≥®Ëß£‰∫ÜÔºå‰πüÂèØ‰ª•‰∏çÈúÄË¶ÅÂ∞ÜÈÖçÁΩÆÁ±ªÁßªÂá∫ÂåÖÊâ´ÊèèË∑ØÂæÑ„ÄÇ ÈÄöËøáÈÖçÁΩÆÊñá‰ª∂ÊåáÂÆö‰ΩÜÊòØ‰ª•‰∏äËøôÊ†∑ÁöÑ‰ª£Á†ÅÈÖçÁΩÆËøòÊòØÁ®çÊòæÂ§çÊùÇÔºåÂú®ÁõÆÂâçÁöÑ SpringCloud ‰∏≠ Ribbon ÁöÑÈÖçÁΩÆÂèØ‰ª•Áõ¥Êé• SpringBoot ÁöÑÈÖçÁΩÆÊñá‰ª∂‰∏≠ÂÜôÂÖ•Ôºå‰ΩøÁî®Â¶Ç‰∏ãÁöÑÊñπÂºèÊåáÂÆöË¶ÅÈÖçÁΩÆÁöÑÂèÇÊï∞Ôºö &lt;nameSpace&gt;.&lt;key&gt;=&lt;value&gt; ÈªòËÆ§ÁöÑÂëΩÂêçÁ©∫Èó¥ÊòØ ribbonÔºå‰æãÂ¶ÇÂÆö‰πâËøûÊé•Ë∂ÖÊó∂Êó∂Èó¥ÂèØ‰ª•Ôºö ribbon.connectTimeout=120 ËÄåÂΩìÈúÄË¶Å‰∏∫ÂÖ∑‰ΩìÁöÑÂÆ¢Êà∑Á´ØÈÖçÁΩÆÊó∂ÔºåÂèØ‰ª•‰ΩøÁî®Ôºö &lt;client&gt;.&lt;nameSpace&gt;.&lt;key&gt;=&lt;value&gt; ÊØîÂ¶ÇÔºö user-service.ribbon.listOfServers=localhost:8001,localhost:8002 ÂÖ≥‰∫é ribbon ÊâÄÊúâÁöÑÂèÇÊï∞ÂêçÁß∞ÔºåÂèØ‰ª•ÂèÇÁúã com.netfix.client.config.CommonClientConfigKey&lt;T&gt;„ÄÇ ‰∏é Eureka Êï¥ÂêàÂêéÁöÑÈÖçÁΩÆÂú®‰ΩøÁî® Eureka ÁöÑÊó∂ÂÄôÔºå‰ºöÊîπÂèò Ribbon ‰∏Ä‰∫õÁªÑ‰ª∂ÁöÑÈªòËÆ§ÂÆûÁé∞ÔºåÂ¶ÇÔºö ServerList -&gt; DiscoveryEnabledNIWSServerListÔºöÁî± Eureka Êù•Áª¥Êä§ÊúçÂä°ÂàóË°® IPing -&gt; NIWSDiscoveryPingÔºöÁî± Eureka ÊµãËØïÊúçÂä°Â≠òÊ¥ªÔºàÂéüÈÖçÁöÑ DummyPing Âπ∂‰∏ç‰ºö pingÔºåËÄåÊòØÂßãÁªàËøîÂõû trueÔºâ ËÄå‰∏îÈíàÂØπ‰∏çÂêåÊúçÂä°‰∏çÈúÄË¶ÅÊòæÁ§∫Âú∞ÈÖçÁΩÆ‰∏ç‰∏ÄÊ†∑ÁöÑÂÆ¢Êà∑Á´ØÂêçÁß∞‰∫ÜÔºåÂè™ÈúÄË¶Å‰ΩøÁî® &lt;serviceName&gt;.&lt;nameSpace&gt;.&lt;key&gt;=&lt;value&gt; Â¶Ç user-serviceÔºö user-service.ribbon.ReadTimeout=120 ÂêåÊó∂Áî±‰∫é SpringCloud Ribbon ÈªòËÆ§ÂÆûÁé∞Âå∫Âüü‰∫≤ÂíåÁ≠ñÁï•Ôºåzone ÁöÑÈÖçÁΩÆ‰πüÂçÅÂàÜÁÆÄÂçïÔºåÂè™ÈúÄË¶ÅÂä†ÂÖ•ÂÖÉÊï∞ÊçÆÈõÜ‰∏≠Âç≥ÂèØÔºåÂ¶ÇÔºö eureka.instance.metadataMap.zone=huzhou Â¶ÇÊûú‰∏çÈúÄË¶Å Eureka ËæÖÂä© Ribbon ÁöÑËá™Âä®ÈÖçÁΩÆÔºàËøô‰∏çÂ§™ÂèØËÉΩÂêßÔºâÔºåÂàôÂèØ‰ª•‰ΩøÁî®Ôºö ribbon.eureka.enable=false ËøôÊó∂ÂÄôÔºåËÆ∞ÂæóËá™Â∑±ÂæóÊâãÂä®ÈÖçÁΩÆ listOfServers Á≠âÂèÇÊï∞‰∫Ü„ÄÇ]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>SpringCloud</tag>
        <tag>Ribbon</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Ê≠£ÂàôÁ¨îËÆ∞]]></title>
    <url>%2F2018%2F06%2F30%2F%E6%AD%A3%E5%88%99%E7%AC%94%E8%AE%B0%2F</url>
    <content type="text"><![CDATA[Êó•Â∏∏ÂºÄÂèë‰∏≠ÔºåÁªèÂ∏∏ÈúÄË¶ÅËøõË°å‰∏Ä‰∫õÊñáÊú¨Â§ÑÁêÜÔºåËøôÈÄöÂ∏∏ÊòØÂçÅÂàÜÁπÅÁêêËÄåÊó†Ë∂£ÁöÑ„ÄÇÂ≠¶‰ºöÂπ∂Âà©Áî®Ê≠£ÂàôË°®ËææÂºèÂèØ‰ª•Âø´ÈÄüËß£ÂÜ≥ËøôÁ±ªÊñáÊú¨Â§ÑÁêÜÈóÆÈ¢òÔºåÊó†ËÆ∫ÊòØÂú® JavaÔºåPython Á≠â‰ª£Á†Å‰∏≠ÊäëÊàñÊòØ shell ÁéØÂ¢É‰∏ã„ÄÇÊ≠£Âàô‰∏≠Â≠òÂú®ÂæàÂ§öÁªÜÂ∞èÁöÑÁü•ËØÜÁÇπÔºåÂçÅÂàÜÂÆπÊòìÈÅóÂøòÔºåÁùÄÊâãËÆ∞ÂΩïÔºåÁü•ËØÜÊï¥ÁêÜËøòÊòØÊúâÊâÄÂøÖË¶Å„ÄÇ Êú¨Êñá‰ª•ÊãìÂ±ïÊ≠£ÂàôËøõË°åÊèèËø∞ÔºåÈÉ®ÂàÜÁâπÊÆäÂ≠óÁ¨¶ÂíåÂÆöÂùÄÊñπÂºèÂú®Ê†áÂáÜÊ≠£Âàô‰∏ãÊó†Êïà„ÄÇÂ¶ÇÈúÄÂú® shell ÁéØÂ¢É‰∏ã‰ΩøÁî®ÔºåÈúÄË¶ÅÈ¢ùÂ§ñ‰ΩøÁî®‚Äò\‚ÄôÁ¨¶Âè∑ÔºåÊàñÂºÄÂêØÊãìÂ±ïÊ≠£ÂàôÁöÑÊîØÊåÅÔºåÂ¶Ç grep -eÔºåsed -r Á≠â„ÄÇ ËßÑÂàôÊ≠£ÂàôË°®ËææÂºèÁöÑËßÑÂàôÂèØ‰ª•ÁÆÄÂçïÁêÜËß£‰∏∫ÔºöÂú®ÁªôÂÆöÁöÑËåÉÂõ¥ÂÜÖÔºåÁªôÂÆöÁöÑÂ≠óÁ¨¶ÈáçÂ§çÁªôÂÆöÁöÑÊ¨°Êï∞„ÄÇ ÊåáÂÆöÈúÄË¶ÅÂåπÈÖçÁöÑÂ≠óÁ¨¶ÁªùÂ§ßÈÉ®ÂàÜÁöÑÂ≠óÁ¨¶ÔºåÂåÖÊã¨Êï∞Â≠óÂ≠óÊØçÊ±âÂ≠óÁ≠âÔºåÈÉΩÂèØ‰ª•Áõ¥Êé•ËæìÂÖ•Êù•ÊèèËø∞„ÄÇ ËΩ¨‰πâÂêéÁâπÊÆäÂ≠óÁ¨¶‰ª•‰∏ãÂá†‰∏™Â≠óÁ¨¶Áî±ËΩ¨‰πâÁ¨¶‚Äò\‚ÄôÂíåÊüê‰∏™Â≠óÁ¨¶ÁªÑÊàêÔºåÂèØ‰ª•Ë°®Ëø∞ÊàêÊñ∞Â≠óÁ¨¶Ôºå‰ªñ‰ª¨ÊúâÁùÄÁâπÊÆäÁöÑÂê´‰πâ„ÄÇ \n ËøôÊòØ‰∏Ä‰∏™Êç¢Ë°åÁ¨¶„ÄÇ \t Âà∂Ë°®Á¨¶ÔºåTab ÈîÆÁöÑÁº©Ëøõ„ÄÇ \v ÂûÇÁõ¥Âà∂Ë°®Á¨¶„ÄÇ \f ÂàÜÈ°µÁ¨¶Ôºå‰∫ßÁîü‰∏Ä‰∏™Êñ∞È°µ„ÄÇ \r ËøôÊòØÂõûËΩ¶Á¨¶ \s Ëøô‰∏™Ë°®ËææÂèØ‰ª•Ë°®Ëø∞ÊâÄÊúâÁöÑÁ©∫ÁôΩÂ≠óÁ¨¶ÔºåÂç≥‰ª•‰∏ä‰∫îÁßçÂ≠óÁ¨¶ÊàñËÄÖÁ©∫Ê†º„ÄÇ \cx ÂΩì x ÂèñÂÄºËã±ÊñáÂ≠óÁ¨¶Êó∂ÔºåËøô‰∏™Êï¥‰ΩìÂ∞±Êúâ‰∫ÜÁâπÊÆäÊÑè‰πâÔºå‰ºöÊò†Â∞ÑÊàê‰∏Ä‰∏™ÊéßÂà∂Â≠óÁ¨¶ÔºåÂ¶Ç \cM Á≠â‰ª∑‰∫é \r Âç≥ÂõûËΩ¶Á¨¶Âè∑„ÄÇ \ux ÂèØ‰ª•ÂåπÈÖç Unicode Â≠óÁ¨¶ÔºåÂ¶Ç \u00CD„ÄÇ \nx Âú® x ÂÄºÂêàÊ≥ïÁöÑÊÉÖÂÜµ‰∏ãÔºåÂèØ‰ª•ÂåπÈÖçÂÖ´ËøõÂà∂‰∏ì‰∏ÄÂÄºÔºàÂú®Ê≤°ÊúâÈ°∫Âà©ÂèñÂæóÁºìÂ≠òÂºïÁî®Êó∂Ôºâ \b Ë°®Á§∫Â≠óÁ¨¶ËæπÁïåÔºåÂèØ‰ª•ÁêÜËß£‰∏∫ÊâìÊñ≠ÂçïËØçÊàñÁùÄÊ±âÂ≠óËøûÁª≠ÁöÑÁ©∫Ê†º/Á¨¶Âè∑‰πãÁ±ªÔºàÂÖ∂ÂÆûÂÆÉÂπ∂‰∏çËÉΩÂåπÈÖçÂà∞Êüê‰∏™Â≠óÁ¨¶Ôºå‰ªÖ‰ªÖÊòØÂåπÈÖçÂà∞‰∫ÜËæπÁïåÔºâ \d Ë°®Á§∫Êï∞Â≠óÔºåÂêå [0-9]„ÄÇ \w Ë°®Á§∫‰ªªÊÑèÂ≠óÁ±ªÂ≠óÁ¨¶ÔºåÂç≥Êï∞Â≠óÂ≠óÊØçÂíå‰∏ãÂàíÁ∫øÔºåÈÄöÂ∏∏ËøòÊîØÊåÅÊ±âÂ≠ó„ÄÇ \&lt; ÂåπÈÖçÂçïËØçÈ¶ñÔºåÊØîÂ¶Ç \&lt;wo ÂèØ‰ª•ÂåπÈÖç woodÔºåword Á≠â„ÄÇ \&gt; ÂêåÁêÜÂåπÈÖçÂçïËØçÂ∞æÈÉ®„ÄÇ ÂéüÁîüÁâπÊÆäÂ≠óÁ¨¶‰ª•‰∏ãÁöÑÂ≠óÁ¨¶Âπ∂‰∏çÈúÄË¶ÅËΩ¨ÁßªÁ¨¶‚Äò\‚ÄôÔºåÂ§©ÁÑ∂ÁöÑÊã•ÊúâÁâπÊÆäÂê´‰πâÔºà‰ª•ÊãìÂ±ïÊ≠£Âàô‰∏∫ÂáÜÔºâ„ÄÇ $ Â∞æÈÉ®ÔºåË°®Á§∫Â≠óÁ¨¶‰∏≤ÁªìÂ∞æ‰ΩçÁΩÆ„ÄÇ ^ Â§¥ÈÉ®ÔºåÂ≠óÁ¨¶‰∏≤ÁöÑÂºÄÂ§¥‰ΩçÁΩÆÔºå‰ΩÜÂú® [ ] ÂÜÖ‰ΩøÁî®Êó∂Ë°®Á§∫ÂèñÂèç [ ] Â∑¶Âè≥‰∏≠Êã¨Âè∑ÔºåÁî®Êù•Ë°®ËææÂåπÈÖçÂçï‰∏™Â≠óÁ¨¶Êó∂ÂÄôÁöÑÂèØÈÄâËåÉÂõ¥ { } Â∑¶Âè≥Ëä±Êã¨Âè∑ÔºåÁî®Êù•Ë°®Ëø∞Ââç‰∏ÄË°®ËææÂºèÁöÑÂèØÈáçÂ§çÂå∫Èó¥ ( ) Â∑¶Âè≥Â∞èÊã¨Âè∑ÔºåÁ±ª‰ººÊï∞Â≠¶‰∏≠ÁöÑÊ¶ÇÂøµÔºåÂèØ‰ª•ÊèèËø∞‰∏Ä‰∏™Ë°®ËææÂºèÂπ∂ÊèêÈ´òËÆ°ÁÆó‰ºòÂÖàÁ∫ßÔºåÂêåÊó∂‰ºöÁºìÂ≠òÂåπÈÖçÁªìÊûú„ÄÇ ¬∑ ÁÇπÂè∑ÔºåÂèØ‰ª•Áî®‰∫ÜÂåπÈÖç‰ªªÊÑèÁöÑ‰∏Ä‰∏™Â≠óÁ¨¶ÔºåÈô§‰∫Ü \n Âêß„ÄÇ * ÊòüÂè∑ÔºåÂèØ‰ª•ÂåπÈÖçÂâçÈù¢Ë°®ËææÂºè‰ªªÊÑèÊ¨°Êï∞„ÄÇ + Âä†Âè∑ÔºåÂåπÈÖçÂâçÈù¢Ë°®ËææÂºè‰∏ÄËá≥‰ªªÊÑèÊ¨°Êï∞. ? ÈóÆÂè∑ÔºåÂåπÈÖçÂâçÈù¢Ë°®ËææÂºè 0 ~ 1 Ê¨°„ÄÇ \ ËΩ¨ÁßªÁ¨¶Êú¨Ë∫´ÔºåÁî®Êù•ËΩ¨ÁßªÂÖ∂‰ªñÂ≠óÁ¨¶ÔºåÈúÄË¶ÅÂåπÈÖçÂÆÉÊú¨Ë∫´ÁöÑÊó∂ÂÄôËá™ÁÑ∂ÈúÄË¶Å \\ ÁöÑÂΩ¢Âºè„ÄÇ | ÊàñËøêÁÆóÁ¨¶Âè∑Ôºå‰ªªÊÑèÂåπÈÖçÂâçÂêéË°®ËææÂºè‰πã‰∏Ä„ÄÇ [:digit:] ÊâÄÊúâÊï∞Â≠ó [:lower:] ÊâÄÊúâÂ∞èÂÜôÂ≠óÊØç [:upper:] ÊâÄÊúâÂ§ßÂÜôÂ≠óÊØç [:alpha:] ÊâÄÊúâÂ≠óÊØç [:alnum:] ÊâÄÊúâÂ≠óÊØçÂèäÊï∞Â≠ó [:space:] ÊâÄÊúâÁ©∫ÁôΩÁ¨¶ [:punct:] ÊâÄÊúâÊ†áÁÇπÁ¨¶Âè∑ ÊåáÂÆöÂåπÈÖçÂ≠óÁ¨¶ÁöÑÂÄôÈÄâËåÉÂõ¥ÂåπÈÖç‰∏Ä‰∏™ÂçïÂ≠óÁ¨¶ÂæàÁÆÄÂçïÔºå‰ΩÜÊòØÈÄöÂ∏∏Êàë‰ª¨ÈúÄË¶ÅÂåπÈÖçÂá†‰∏™Â≠óÁ¨¶‰∏≠ÁöÑ‰ªªÊÑè‰∏Ä‰∏™ÔºåËøô‰∏™Êó∂ÂÄôÂ∞±ÈúÄË¶Å‰∏Ä‰∏™ÂÄôÈÄâËåÉÂõ¥ÁöÑÊèèËø∞„ÄÇÈô§‰∫Ü‰ΩøÁî® \w Ë°®Á§∫Â≠óÁ±ªÂ≠óÁ¨¶Ôºå\s Êù•Ë°®Á§∫Á©∫ÁôΩÁ¨¶„ÄÇ‰πüÂèØ‰ª•‰ΩøÁî® [ ] ÊñπÊã¨Âè∑Êù•ÊèèËø∞ËåÉÂõ¥ÔºåÊù•ÁúãÂá†‰∏™‰æãÂ≠êÔºö [abc] ÂÆÉÂèØ‰ª•ÊòØÂåπÈÖç aÔºå‰πüÂèØ‰ª•ÊòØ bÔºå‰πüÂèØ‰ª•ÊòØ c„ÄÇ 5[48]k ÂÆÉÂèØ‰ª•ÊòØ 54kÔºå‰πüÂèØ‰ª•ÊòØ 58k„ÄÇ [0-9]\w ÂÆÉÂèØ‰ª•‰ΩøÊòØ 0aÔºå3bÔºå33 Á≠âÁ≠â„ÄÇ ËøôÊ†∑‰∏ÄÁúãÊòØ‰∏çÊòØÂæàÂÆπÊòìÔºüÊù•Áúã‰∏Ä‰∫õËøõÈò∂ÊäÄÂ∑ßÔºö ÂèñÂèç„ÄÇË°®Ëø∞ËåÉÂõ¥ÁöÑÁ¨¶Âè∑ÂèØ‰ª•ÈÄöËøáÂ§ßÂÜôÊù•Ë°®Á§∫ÂèñÂèçÔºå\S Ë°®Á§∫ÈùûÁ©∫ÁôΩÂ≠óÁ¨¶Ôºå\B Ë°®Á§∫ÈùûÂ≠óÁ¨¶ËæπÁïåÔºå\W Ë°®Á§∫ÈùûÂ≠óÁ±ªÂ≠óÁ¨¶„ÄÇÂØπ‰∫é‰ΩøÁî® [ ] ÁöÑÂú∫ÂêàÔºå‰ΩøÁî® [^ ] Êù•ÂÆåÊàêÂèñÂèç„ÄÇ [ ] ÊñπÊã¨Âè∑‰∏≠Èó¥‰∏çÂÜçËÉΩ‰ΩøÁî®‰∏äËø∞ÁâπÊÆäÁöÑÂ≠óÁ¨¶ÔºåÊØîÂ¶Ç [x*]Ôºå* ‰∏çÂÜçÂåπÈÖç‰ªªÊÑèÊ¨° xÔºåËøô‰∏™Ë°®ËææÂºèÂè™ËÉΩÂåπÈÖç * Êàñ xÔºõÂêåÁêÜÊØîÂ¶ÇÔºö[\s] Ë°®Á§∫ \ ÊàñËÄÖ s„ÄÇ [ ] ‰∏≠ÂèØ‰ª•‰ΩøÁî®‰∏Ä‰∫õÁâπÂÆöÁöÑËåÉÂõ¥ÔºåÊØîÂ¶Ç 0-9Ôºåa-zÔºåA-Z„ÄÇÊØîÂ¶ÇÂºèÂ≠ê [0-9A-Z] ‰πüÊòØÂêàÁêÜÁöÑÔºå‰ºöÂåπÈÖçÊï∞Â≠óÊàñËÄÖÂ§ßÂÜôÂ≠óÊØçÔºåÂ¶ÇÈúÄË¶ÅÂåπÈÖç‚Äò-‚ÄôÔºåÂ∞ΩÈáèÂÜôÂú®ÊúÄÂêé„ÄÇ ÊåáÂÆöË°®ËææÂºèÁöÑÈáçÂ§çÊ¨°Êï∞Âú®ÈúÄË¶ÅÈáçÂ§ç‰∏Ä‰∏™ÁâπÂÆöÁöÑÊ≠£ÂàôË°®ËææÂºèÁöÑÊó∂ÂÄôÔºåÊàë‰ª¨ÂèØ‰ª•‰ΩøÁî®ÈôêÂÆöÁ¨¶ÊèèËø∞ÈáçÂ§çÊ¨°Êï∞Êù•ÁÆÄÂåñÂÆÉ„ÄÇ {n} ÂåπÈÖç n Ê¨°ÔºåÂ¶Ç C{3} Âç≥ CCC„ÄÇ {n,} ÂåπÈÖçÂ§ß‰∫éÁ≠â‰∫é n Ê¨°„ÄÇÂ¶Ç C{1,} Á≠âÂêå‰∫é C+ {n,m} ÂåπÈÖçÂ§ß‰∫éÁ≠â‰∫é n Ê¨°ÔºåÂ∞è‰∫éÁ≠â‰∫é m Ê¨°ÔºåÈó≠Âå∫Èó¥„ÄÇ * Á≠âÂêå‰∫é {0,} + Á≠âÂêå‰∫é {1,} ? Á≠âÂêå‰∫é {0,1} Âà©Áî®Ê≠£ÂàôÂåπÈÖçÁöÑÁºìÂ≠ò \num ‰ΩøÁî® ( ) ‰πãÂêé‰ºöËøõË°åÂåπÈÖçÂÄºÁöÑÁºìÂ≠òÔºåÂèØ‰ª•Á¥ßË∑üÁùÄ \num ÊåáÂÆöÂåπÈÖçÁöÑÂ≠êÈ°πÔºåÊØîÂ¶Ç (.)\1 ÂèØ‰ª•ÂåπÈÖç‰ªªÊÑè‰∏§‰∏™Áõ∏ÂêåÁöÑÂ≠óÁ¨¶„ÄÇÊàñËÄÖÂú® sedÔºåvim Á≠âÂ∑•ÂÖ∑‰ΩøÁî®ÊõøÊç¢Êìç‰ΩúÊó∂ÔºåÂèØ‰ª•Âú®Êñ∞Â≠óÁ¨¶‰∏≤‰∏ä‰ΩøÁî® \num ‰ª•ÊúüËææÂà∞Á≤æÁ°ÆÁöÑÂåπÈÖç‰ΩÜÊòØÂ±ÄÈÉ®ÊõøÊç¢ÁöÑÊïàÊûú„ÄÇ (?:pattern) ‰ΩøÁî®ËØ•Á¨¶Âè∑‰ºöÂèñÊ∂àÂåπÈÖçÂÄºÁöÑÁºìÂ≠ò (?=pattern) Ê≠£ÂêëËÇØÂÆöÈ¢ÑÊü•Ôºå‰ΩøÁî®ËØ•Á¨¶Âè∑‰ºöÂèñÊ∂àÂåπÈÖçÂÄºÁöÑÁºìÂ≠òÔºåÂêåÊó∂È¢ÑÊü•‰πüÊòØ‰∏çÊ∂àËÄóÂ≠óÁ¨¶ÁöÑ„ÄÇ (?!pattern) ÂèçÂêëÈ¢ÑÊü•ÔºåÁõ∏Âèç‰∫éÂâçËÄÖ]]></content>
      <categories>
        <category>shell</category>
      </categories>
      <tags>
        <tag>Regex</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ËôöÊãüÊú∫‰∏≠ÁöÑÈîÅËÜ®ËÉÄ]]></title>
    <url>%2F2018%2F06%2F30%2F%E8%99%9A%E6%8B%9F%E6%9C%BA%E4%B8%AD%E7%9A%84%E9%94%81%E8%86%A8%E8%83%80%2F</url>
    <content type="text"><![CDATA[Â∞ΩÁÆ°ÂΩì‰∏ãÂá†‰πéÊâÄÊúâÁöÑÊúçÂä°Âô®ÁéØÂ¢ÉÈÉΩ‰ª•ÈõÜÁæ§‰∏∫‰∏ªÔºåÂú®ËÄÉËôëÂπ∂ÂèëÈóÆÈ¢òÁöÑÊó∂ÂÄôÈÄöÂ∏∏‰ºö‰ΩøÁî®ÂàÜÂ∏ÉÂºèÊäÄÊúØ,Â¶Ç redis Á≠â‰∏≠Èó¥‰ª∂Êù•Áª¥Êä§ÂÖ®Â±ÄÁöÑËµÑÊ∫êÂíåÈîÅ„ÄÇ‰ΩÜÊòØÂØπ‰∫é‰∏Ä‰∫õÂÆû‰æãÂ±ÇÈù¢‰∏äÁöÑËµÑÊ∫êÔºå‰æùÊóßÈúÄË¶Å‰ΩøÁî®‰º†ÁªüÁöÑÈîÅÊù•Áª¥Êä§„ÄÇÊâÄ‰ª•ÊàëËßâÂæóÔºåÁêÜËß£ JVM ÂØπÈîÅÁöÑÂ§ÑÁêÜËøòÊòØÊúâ‰ª∑ÂÄºÁöÑ„ÄÇ JVM‰∏äÈíàÂØπÈîÅÁöÑÂ§ÑÁêÜÔºàËøôÈáåÂè™ÊèèËø∞ÂÜÖÈÉ®ÈîÅÔºåÂç≥ synchronized ÁöÑÂ§ÑÁêÜÊÉÖÂÜµÔºâÔºåÈô§‰∫ÜÊúâËá™ÊóãÈîÅÔºåÈîÅÁ≤óÂåñÔºåÈîÅÊ∂àÈô§Á≠âÁÆÄÂçïÁöÑËá™Âä®‰ºòÂåñÊú∫Âà∂Ôºà‰∏çÊé¢ËÆ®Âï¶ÔºâÔºåËøòÂèØ‰ª•‰ªéÈîÅÁöÑÁª¥Êä§ÁöÑËßíÂ∫¶ÂéªÁúãÔºåÂèØ‰ª•ÂàÜ‰∏∫ÂÅèÂêëÈîÅÔºåËΩªÈáèÁ∫ßÈîÅÔºåÈáçÈáèÁ∫ßÈîÅ„ÄÇ‰∏âËÄÖÁöÑÂºÄÈîÄÊòØÈÄíÂ¢ûÁöÑÔºåÊºîÂèòÈ°∫Â∫è‰πüÊòØÈÄíÂ¢ûÁöÑÔºåËÄå‰∏î‰∏çÂèØÈÄÜ„ÄÇÂ¶ÇËΩªÂûãÁöÑÈîÅÂèØ‰ª•ËÜ®ËÉÄÂçáÁ∫ßËá≥ÈáçÂûãÈîÅÔºå‰ΩÜÊòØ‰∏çÂèØ‰ª•‰ªéÈáçÂûãÁöÑÈîÅÈôçÁ∫ß„ÄÇ ‰πãÊâÄ‰ª•Êúâ‰∏çÂêåÁ®ãÂ∫¶ÁöÑÈîÅÁöÑÂ§ÑÁêÜÊñπÂºèÔºåÂèØ‰ª•Áúã‰∏Ä‰∏ãËøô‰∏Ä‰∏™Âú∫ÊôØÔºöÂ¶ÇÊûúÂú®ÈÄªËæë‰∏äÊüê‰∏ÄÊó∂Èó¥Âü∫Êú¨Âè™Êúâ‰∏Ä‰∏™Á∫øÁ®ãÔºå‰ºöËÆøÈóÆÁî±Êüê‰∏™ÈîÅÂØπË±°ÊéßÂà∂ÁöÑÂêåÊ≠•ÂùóÔºåÂæàÂ§öÊó∂ÂÄô‰∏çÂ≠òÂú®ËµÑÊ∫êÂæÅÁî®ÁöÑÈóÆÈ¢ò„ÄÇÈÇ£‰πàÂú®Ëøô‰∏™Êó∂ÂÄôÔºåÂæàÂ§öÊó∂ÂÄô‰∏äÈîÅËß£ÈîÅÁöÑÂºÄÈîÄÂ∞±ÊòæÂæóÁπÅÁêêËÄå‰ΩéÊïà‰∫Ü„ÄÇ‰ª•ÈáçÈáèÁ∫ßÈîÅÔºà‰πüÊòØ synchronized ÁöÑÊúÄÁªàÂΩ¢ÊÄÅÔºâ‰∏∫‰æãÔºåÂèñÈîÅËøáÁ®ãÈúÄË¶ÅÊìç‰ΩúÁ≥ªÁªüÁöÑ‰ªãÂÖ•Ôºå‰ΩøÁ∫øÁ®ã‰ªéÁî®Êà∑ÊÄÅËøõÂÖ•Ê†∏ÂøÉÊÄÅÔºåÂºÄÈîÄËøòÊòØÊå∫Â§ßÁöÑ„ÄÇÊâÄ‰ª•‰∏ÄÂºÄÂßã JVM ‰ºöÂØπÈîÅÂÅöÂÅèÂêëÈîÅÂ§ÑÁêÜÔºåÂú®‰∏Ä‰∫õÊù°‰ª∂‰∏ãÂçáËá≥ËΩªÈáèÁ∫ßÈîÅ‰πÉËá≥ÈáçÈáèÁ∫ßÈîÅ„ÄÇ ÂâçÁΩÆÊ¶ÇÂøµÂú®ÈòêËø∞ÈîÅËÜ®ËÉÄ‰πãÂâçÔºåÂÖàÊèíÂÖ•Âá†‰∏™ÂÜÖÂÆπÁÇπÔºåÂØπË±°Â§¥ÂíåËá™ÊóãÈîÅ„ÄÇ ÂØπË±°Â§¥Âú® HotSpot ËôöÊãüÊú∫‰∏≠ÔºåÂØπË±°Âú®ÂÜÖÂ≠ò‰∏≠Â≠òÂÇ®ÁöÑÂ∏ÉÂ±ÄÂèØ‰ª•ÂàÜ‰∏∫‰∏âÂùóÂå∫ÂüüÔºöÂØπË±°Â§¥ÔºàHeaderÔºâ„ÄÅÂÆû‰æãÊï∞ÊçÆÔºàInstance DataÔºâÂíåÂØπÈΩêÂ°´ÂÖÖÔºàPaddingÔºâ„ÄÇ ÂÆû‰æãÊï∞ÊçÆÂÜÖÂÆπÂíåÂØπÈΩêÂ°´ÂÖÖ‰∏çÂú®ËµòËø∞ÔºåËØ¥ËØ¥ÂØπË±°Â§¥ÔºåËøôÂ∞±Á±ª‰ºº‰∏Ä‰∏™ÂØπË±°ÁöÑÂÖÉ‰ø°ÊÅØÔºåÂÖ∂‰∏≠‰πüÂàÜ‰∏∫‰∏âÈÉ®ÂàÜÁªÑÊàêÔºöÊ†áËÆ∞Â≠óÊÆµ Mark WordÔºåÁ±ªÂûãÊåáÈíà Class PointerÔºåÊï∞ÁªÑÈïøÂ∫¶ Array LengthÔºàÂ¶ÇÊûúËØ•ÂØπË±°ÊòØÊï∞ÁªÑÔºåÂàôËÆ∞ÂΩï‰∫ÜÊï∞ÁªÑÈïøÂ∫¶ÔºâÔºå‰∏âÁªÑÊï∞ÊçÆÂàÜÂà´Áî®‰∏Ä‰∏™Â≠óÈïøÊù•Â≠òÂÇ®Ôºà32‰ΩçÊú∫‰∏ä‰∏∫32bitÔºå64‰ΩçÊú∫‰Ωç64bitÔºâ„ÄÇ Á±ªÂûãÊåáÈíàÔºöÂú®ËôöÊãüÊú∫Âä†ËΩΩÁ±ªÁöÑÊó∂ÂÄôÔºåÈô§‰∫Ü‰ºöÂú®ÂÖÉÁ©∫Èó¥/ÊñπÊ≥ïÂå∫Â≠òÂÇ®Á±ª‰ø°ÊÅØÔºå‰πü‰ºöÂú®Â†ÜÂå∫ÁîüÊàê‰∏Ä‰∏™ Class ÂØπË±°„ÄÇÁ±ªÂûãÊåáÈíàÔºå‰æøÊòØ‰∏∫‰∏Ä‰∏™ÂÆû‰æãÂØπË±°ÊåáÂêë Class ÂØπË±°ÁöÑÊåáÈíà„ÄÇ Ê†áËÆ∞Â≠óÊÆµÔºöÂú®Ëøô‰∏Ä‰∏™Â≠óÁöÑÂå∫ÂüüÂÜÖÔºåÊèèËø∞‰∫ÜÂæàÂ§ö‰ø°ÊÅØ„ÄÇÈÄöÂ∏∏‰∏Ä‰∏™ÂØπË±°‰ºöÊúâÂÖ∂ÂìàÂ∏åÁ†ÅÔºåÂπ¥‰ª£Ê†áËÆ∞ÔºàÁªèÂéÜ GC Ê¨°Êï∞ÔºâÔºåÈîÅÊ†áËØÜÁ≠â„ÄÇ‰ΩÜÊòØÂ¶ÇÊûúËØ•ÂØπË±°ÂÖÖÂΩì‰∫Ü‰∏Ä‰∏™‰∏äÈîÅÂØπË±°ÔºåÊÉÖÂÜµ‰ºöÊúâÊâÄ‰∏çÂêåÔºå‰∏ãÊñáËØ¶Ëø∞„ÄÇ Ëá™ÊóãÈîÅÈÄöÂ∏∏Êù•ËØ¥ÔºåÂèñÈîÅÊó∂ÂÄôÂ¶ÇÊûúÊú™ËÉΩËé∑ÂæóÈîÅÔºåÁ∫øÁ®ã‰ºöËøõÂÖ•ÈòªÂ°ûÁä∂ÊÄÅÔºàBlockingÔºâÔºåÂêåÊó∂‰ºöËÆ©Á∫øÁ®ãËøõÂÖ•Á≠âÂæÖÈòüÂàó/ÂêåÊ≠•ÂùóÁöÑÂÖ•Âè£ÈõÜ‰∏≠ÔºåÂπ∂ÂØºËá¥‰∏Ä‰∏™‰∏ä‰∏ãÊñáÂàáÊç¢ÔºåÂá∫ËÆ© CPU ËµÑÊ∫ê„ÄÇÊàë‰ª¨ÂèØ‰ª•ÂÆûÁé∞‰∏Ä‰∏™ÂøôËΩÆËØ¢ÁöÑÊú∫Âà∂Êù•Â∞ùËØïËé∑ÂæóÈîÅ„ÄÇÊØîÂ¶Ç‰ΩøÁî®‰∏Ä‰∏™Áä∂ÊÄÅÂØπË±°Êù•‰ª£ÊõøÈîÅÔºå‰ΩøÁî®‰∏Ä‰∏™Âæ™ÁéØÊù•Âà§Êñ≠Áä∂ÊÄÅÊòØÂê¶Êú™ÂèØÁî®ÔºåÂ¶Ç‰∏ãÊòØ‰ª£Á†ÅÂ±ÇÈù¢ÁöÑÂÆûÁé∞„ÄÇ1234567volatile boolean flag = false;while(true) &#123; if(flag) &#123; // do something break; &#125;&#125; ËøôÂèØ‰ª•ÈÅøÂÖçÂú®È¶ñÊ¨°ÂèñÂæóÈîÅÂ§±Ë¥•ÁöÑÊó∂ÂÄôÁõ¥Êé•Á∫øÁ®ãÂàáÂá∫ÔºåÂú®ÂêåÊ≠•ÈÄªËæëÂ§ÑÁêÜÈáèËæÉÂ∞ëÁöÑÊó∂ÂÄôÂèØ‰ª•Â∏¶Êù•ÊòéÊòæÁöÑÊïàÁéáÊèêÂçáÔºå‰ΩÜÊòØÂ¶ÇÊûúÂ¶ÇÊûúËØ¥‚ÄúÂêåÊ≠•Âùó‚ÄùÁöÑÂ§ÑÁêÜÊó∂Èó¥ÂæàÈïøÔºåÊàñËÄÖÂú®‚ÄúÂêåÊ≠•Âùó‚ÄùÂÜÖÁöÑÁ∫øÁ®ãÂèëÁîüÂºÇÂ∏∏Êú™ËÉΩÊõ¥ÊîπÁä∂ÊÄÅÈáèÔºåÂ∞Ü‰∏•ÈáçÊçüÂ§±ÊÄßËÉΩ‰πÉËá≥ÂèëÁîüÊõ¥‰∏•ÈáçÁöÑÊ≠ªÈîÅ„ÄÇ ÊâÄ‰ª•Ëá™ÊóãÈîÅÈÄÇÂêàÂêåÊ≠•ÈÄªËæëÁöÑÂ§ÑÁêÜÊó∂Èó¥ÂæàÁü≠ÁöÑÂú∫ÂêàÔºàÂá†‰∏™Âæ™ÁéØÂÜÖËÉΩÊãøÂà∞ÈîÅÔºâ ÈîÅËÜ®ËÉÄËøáÁ®ã‰∏≠ÁöÑ‰∏â‰∏™Èò∂ÊÆµÁé∞Âú®Â∑≤Áªè‰∫ÜËß£‰∫ÜÂØπË±°Âú®Â†Ü‰∏≠ÁöÑÂ≠òÂÇ®ÂΩ¢ÂºèÔºå‰ª•Âèä‰æùÈù†Ëá™ÊóãÂèØ‰ª•Âú®Áü≠Êó∂Èó¥ÂÜÖÂáèÂ∞ëÂä†ÈîÅÂºÄÈîÄ„ÄÇÁªßÁª≠Ê∑±ÂÖ• JVM ‰∏≠‰∏çÂêåÂπ∂ÂèëÁ®ãÂ∫¶‰∏ãÈîÅÁöÑ‰∏çÂêåÁöÑÊú∫Âà∂„ÄÇ ÂÅèÂêëÈîÅÂÅèÂêëÈîÅÊòØÂú® JDK 1.5Ôºü1.6 ‰πãÂêéÂØπÈîÅËøõË°åÁöÑ‰ºòÂåñ„ÄÇÂÖàÊù•Áúã‰∏Ä‰∏™ÂõæÔºö ÂâçÊñáÊèêÂà∞ËøáÔºåÂ¶ÇÊûú‰∏Ä‰∏™Á∫øÁ®ãÁªèÂ∏∏Ëé∑ÂæóÈîÅÔºå‰∏îËµÑÊ∫ê‰∫âÁî®‰∏ç‰∏•ÈáçÔºåÈÇ£‰πàÂèØ‰ª•Â∞ΩÈáèÂáèÂ∞ëÂèñÈîÅÁöÑÂºÄÈîÄ„ÄÇJDK ÊòØËøô‰πàÂÅöÁöÑÔºöÂú®‰∏Ä‰∏™Á∫øÁ®ãËé∑ÂæóÈîÅÁöÑÊó∂ÂÄôÔºå‰ºöÂú®Ê†àÂ∏ßËÆ∞ÂΩï‰∏≠‰ª•ÂèäÈîÅÂØπË±°ÁöÑÊ†áËÆ∞Â≠óÊÆµ‰∏≠ÂÜôÂÖ•Á∫øÁ®ã idÔºåÂú®ËØ•Á∫øÁ®ãËøõÂÖ•/Á¶ªÂºÄÂêåÊ≠•ÂùóÁöÑÊó∂ÂÄô‰∏çÈúÄË¶ÅÈ¢ùÂ§ñÁöÑÈîÅÂºÄÈîÄÔºåËøôÈáåÁîöËá≥‰∏çÈúÄË¶Å CAS Êìç‰ΩúÔºåÂõ†‰∏∫Âè™ÈúÄË¶ÅÊØîËæÉÊ†áËÆ∞Â≠óÊÆµ‰∏≠ÁöÑÁ∫øÁ®ã id ‰∏éËá™Ë∫´ÊòØÂê¶‰∏ÄËá¥„ÄÇÂ¶ÇÊûúÂú®Â∞ùËØïËé∑ÂæóÈîÅÁöÑÊó∂ÂÄôÂèëÁé∞Ê†áËÆ∞Â≠óÊÆµ‰∏≠ÁöÑÁ∫øÁ®ã id ‰∏éËá™Ë∫´‰∏ç‰∏ÄËá¥Ôºå‰ºöÂ∞ùËØïÂà©Áî® CAS Êìç‰ΩúÊù•‰∫âÊä¢Ëøô‰∏™ÂÅèÂêëÈîÅ„ÄÇ Ë°•ÂÖÖÔºöÂÅèÂêëÈîÅÊòØÈªòËÆ§ÂêØÁî®ÁöÑÔºå‰ΩÜÊòØÂÆÉÂú®Â∫îÁî®Á®ãÂ∫èÂêØÂä®Âá†ÁßíÈíü‰πãÂêéÊâçÊøÄÊ¥ªÔºåÂ¶ÇÊúâÂøÖË¶ÅÂèØ‰ª•‰ΩøÁî® JVM ÂèÇÊï∞Êù•ÂÖ≥Èó≠Âª∂Ëøü -XX:BiasedLockingStartupDelay=0„ÄÇÂ¶ÇÊûú‰Ω†Á°ÆÂÆöËá™Â∑±Â∫îÁî®Á®ãÂ∫èÈáåÊâÄÊúâÁöÑÈîÅÈÄöÂ∏∏ÊÉÖÂÜµ‰∏ãÂ§Ñ‰∫éÁ´û‰∫âÁä∂ÊÄÅÔºåÁîöËá≥ÂèØ‰ª•ÈÄöËøá JVM ÂèÇÊï∞ÂÖ≥Èó≠ÂÅèÂêëÈîÅ -XX:-UseBiasedLocking=falseÔºåÈÇ£‰πàÊâÄÊúâÁöÑÂÜÖÈÉ®ÈîÅÈÉΩ‰ºöÁõ¥Êé•ËøõÂÖ•ËΩªÈáèÁ∫ßÈîÅÁä∂ÊÄÅ„ÄÇ ËΩªÈáèÁ∫ßÈîÅÁ∫øÁ®ãÂú®ÊâßË°åÂêåÊ≠•Âùó‰πãÂâçÔºåJVM ‰ºöÂÖàÂú®ÂΩìÂâçÁ∫øÁ®ãÁöÑÊ†àÊ°¢‰∏≠ÂàõÂª∫Áî®‰∫éÂ≠òÂÇ®ÈîÅËÆ∞ÂΩïÁöÑÁ©∫Èó¥ÔºåÂπ∂Â∞ÜÂØπË±°Â§¥‰∏≠ÁöÑÊ†áËÆ∞Â≠óÊÆµÂ§çÂà∂Âà∞ÈîÅËÆ∞ÂΩï‰∏≠„ÄÇÁÑ∂ÂêéÁ∫øÁ®ãÂ∞ùËØï‰ΩøÁî® CAS Â∞ÜÂØπË±°Â§¥‰∏≠ÁöÑÊ†áËÆ∞Â≠óÊÆµÊõøÊç¢‰∏∫ÊåáÂêëÈîÅËÆ∞ÂΩïÁöÑÊåáÈíà„ÄÇÂ¶ÇÊûúÊàêÂäüÔºåÂΩìÂâçÁ∫øÁ®ãËé∑ÂæóÈîÅÔºõÂ¶ÇÊûúÂ§±Ë¥•ÔºåÂàôËøõË°åËá™ÊóãÊù•Ëé∑ÂèñÈîÅÔºåÂΩìËá™ÊóãËé∑ÂèñÈîÅ‰ªçÁÑ∂Â§±Ë¥•Êó∂ÔºåË°®Á§∫Á´û‰∫â‰∏•ÈáçÔºà‰∏§Êù°Êàñ‰∏§Êù°‰ª•‰∏äÁöÑÁ∫øÁ®ãÁ´û‰∫âÂêå‰∏Ä‰∏™ÈîÅÔºâÔºåÂàôËΩªÈáèÁ∫ßÈîÅ‰ºöËÜ®ËÉÄÊàêÈáçÈáèÁ∫ßÈîÅ„ÄÇ ÈáçÈáèÁ∫ßÈîÅÈáçÈáèÁ∫ßÈîÅÂÖ∂ÂÆûÊâçÊòØÈÄöÂ∏∏Ê∂âÂèäÁöÑÈîÅÊ¶ÇÂøµÔºåËøôÊó∂ÂÄôÂÆÉÂ∑≤ÁªèÊòØ‰∏Ä‰∏™ÂΩªÂ∫ïÁöÑÊÇ≤ËßÇÈîÅ‰∫Ü„ÄÇÂú® JVM ‰∏≠ÂèàÂè´ÂØπË±°ÁõëËßÜÂô®ÔºåÂÆÉËá≥Â∞ëÂåÖÂê´‰∏Ä‰∏™Á´û‰∫âÈîÅÁöÑÈòüÂàóÔºåÂíå‰∏Ä‰∏™‰ø°Âè∑ÈòªÂ°ûÈòüÂàóÔºàwaitÈòüÂàóÔºâÔºåÂâçËÄÖË¥üË¥£ÂÅö‰∫íÊñ•ÔºåÂêé‰∏Ä‰∏™Áî®‰∫éÂÅöÁ∫øÁ®ãÂêåÊ≠•„ÄÇ ÂèÇËÄÉ „ÄäJavaÂ§öÁ∫øÁ®ãÁºñÁ®ãÂÆûÊàòÊåáÂçó„Äã ÈªÑÊñáÊµ∑ „ÄäÊ∑±ÂÖ•ÁêÜËß£JavaËôöÊãüÊú∫„Äã Âë®ÂøóÊòé https://www.cnblogs.com/wade-luffy/p/5969418.html https://blog.csdn.net/wolegequdidiao/article/details/45116141]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Âπ∂Âèë</tag>
        <tag>JVM</tag>
      </tags>
  </entry>
</search>
